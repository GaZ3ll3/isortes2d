
/*
 *  Steady-State Radiative Transport Equation Solver for Isotropic Scattering in 2D.
 *
 *  copyright@ Yimin Zhong. yzhong@math.utexas.edu.
 *
 *  About:
 *
 *  1. This program solves RTE by volumetric integral formulation, where integral is evaluated by FMM.
 *
 *  2. The integral equation is second kind, solved by Krylov subspace method e.g. GMRES, MINRES, BICGSTAB.
 *
 *  3. Integral part is based on the paper "A NYSTRÃ–M METHOD FOR WEAKLY SINGULAR INTEGRAL OPERATORS ON SURFACES" of
 *  J.Bremer and Z.Gimbutas.
 *
 *  4. FMM method uses BlackBox Fast Multipole Method by Darve and Fong.
 *
 *
 *  Limitation:
 *
 *  Support int32 particle number only.
 *
 */

#define DISP

#include <iostream>
#include "bbfmm.h"
#include "geometry_triangle.h"
#include "modes.h"
#include "polynomials.h"

using namespace bbfmm;

extern void domain_information(geometry_triangle *);

extern void modes_information(QRule_tri &);

extern void
makeKoornwinderMatrix(Matrix &K, int N, vector<long double> &x, vector<long double> &y, vector<long double> &w);

extern void
reorg(geometry_triangle *);

extern void duffy_transform(vector<scalar_t> points, vector<scalar_t> &X, vector<scalar_t> &Y, vector<scalar_t> &W);

static long double x64[128] = {
        -0.012223698960615764198052119667406631855885971429889554101908012812187844561455470572480193019918723716276944372158658413834878404811961223316909350659334328956284877486363924080105218572925340673069163510071218567120972058507558988356955199058537320113665578759903273404,
        0.012223698960615764198052119667406631855885971429889554101908012812187844561455470572480193019918723716276944372158658413834878404811961223316909350659334328956284877486363924080105218572925340673069163510071218567120972058507558988356955199058537320113665578759903273404,
        -0.036663790968733493330215348789448873789688979532132057058492770600598383585424113534751616046126451366028688144924877960982833522145846309672092984580665227822986608057760381602203167342512012771761618115648573813629088738334134079102813304850183827665309895725301861158,
        0.036663790968733493330215348789448873789688979532132057058492770600598383585424113534751616046126451366028688144924877960982833522145846309672092984580665227822986608057760381602203167342512012771761618115648573813629088738334134079102813304850183827665309895725301861158,
        -0.061081969604139568103787023522318463239682319400108716191660636907879622912075453023452942091320876667321811726557709113378773157803478722372958059883159392378206670624208925176164630047426000290790078828733400211924983208811402797862009587142625596710036459675535403142,
        0.061081969604139568103787023522318463239682319400108716191660636907879622912075453023452942091320876667321811726557709113378773157803478722372958059883159392378206670624208925176164630047426000290790078828733400211924983208811402797862009587142625596710036459675535403142,
        -0.085463640504515498636498034460249145740002590281596687540701324217755029029135488332171141565985881858401348391185445928702873431195228934194648963695980665785763487753785995282304392467632269272945603893924802482922102929985321616883520472475108148751852785134916581972,
        0.085463640504515498636498034460249145740002590281596687540701324217755029029135488332171141565985881858401348391185445928702873431195228934194648963695980665785763487753785995282304392467632269272945603893924802482922102929985321616883520472475108148751852785134916581972,
        -0.10979423112764374667297466740117803253882172849755899563772703666050031488223835311294954240826218634472176512668731004198340328270813175774413938720432138659477948212112395170276328473634706399127630157708596941609604748973885010825823798554785168819383081125927545176,
        0.10979423112764374667297466740117803253882172849755899563772703666050031488223835311294954240826218634472176512668731004198340328270813175774413938720432138659477948212112395170276328473634706399127630157708596941609604748973885010825823798554785168819383081125927545176,
        -0.134059199461187785117575317260796288330342383991028374648895361655237909293552824680578655977044584806068827354717374327486968914294963686670389535321774481534168991916570294802749442691234098493605265485341888407552155201023660860058039367315417685500279792234664227244,
        0.134059199461187785117575317260796288330342383991028374648895361655237909293552824680578655977044584806068827354717374327486968914294963686670389535321774481534168991916570294802749442691234098493605265485341888407552155201023660860058039367315417685500279792234664227244,
        -0.158244042714224933997475452139466149812270977066871128304278660181929019156025599844874954928889663365290913289336432816252360526017573537008318514876314318455074166629947276988123843060716530120619794442320047356787067376086440204130945459170128379571698660958495404114,
        0.158244042714224933997475452139466149812270977066871128304278660181929019156025599844874954928889663365290913289336432816252360526017573537008318514876314318455074166629947276988123843060716530120619794442320047356787067376086440204130945459170128379571698660958495404114,
        -0.182334305985337182410382574860777758959514816011287441925383624674408367099397709546410285949328461595131228859705017747201254589999151616749346425234278587372073336033642855678357970608204035193534664352874021437894219687178436057483866497658593870012982621674856668037,
        0.182334305985337182410382574860777758959514816011287441925383624674408367099397709546410285949328461595131228859705017747201254589999151616749346425234278587372073336033642855678357970608204035193534664352874021437894219687178436057483866497658593870012982621674856668037,
        -0.206315590902079217154058010827953290261681542778520541144756279744541569368344057222952248994062702655196906948215839155938577229991804480721000699625427992866926013661603716916047171633872177966411667414410037536952312144553359336065745618411775815758359652227976985353,
        0.206315590902079217154058010827953290261681542778520541144756279744541569368344057222952248994062702655196906948215839155938577229991804480721000699625427992866926013661603716916047171633872177966411667414410037536952312144553359336065745618411775815758359652227976985353,
        -0.230173564226659986410986577211763609104587799708940222046776800132234862822562845338932152552533118487121784639131139482603889207945599088607680771125260281682295731171939569147529879366228514649060567062303792728646398481499097393459972030391780585485712888368141396843,
        0.230173564226659986410986577211763609104587799708940222046776800132234862822562845338932152552533118487121784639131139482603889207945599088607680771125260281682295731171939569147529879366228514649060567062303792728646398481499097393459972030391780585485712888368141396843,
        -0.253893966422694320855617996495655581171254531561424667767952935040525573689801962924103801124214946539423171605901392569068358877915107270063056352011839967640238370844485903701589871791220038021809365251370015831036090874405070988030238066523215121507413935989814045999,
        0.253893966422694320855617996495655581171254531561424667767952935040525573689801962924103801124214946539423171605901392569068358877915107270063056352011839967640238370844485903701589871791220038021809365251370015831036090874405070988030238066523215121507413935989814045999,
        -0.277462620177904402806231634076386216888861042710275861764364613440676054130602176481326658776621942580302247797033781181108336097200183554719315624686275142964288500227810080278511626619442027257107734288606044737968277276797867994342594715494521740307999401393300617496,
        0.277462620177904402806231634076386216888861042710275861764364613440676054130602176481326658776621942580302247797033781181108336097200183554719315624686275142964288500227810080278511626619442027257107734288606044737968277276797867994342594715494521740307999401393300617496,
        -0.300865438877677202667154094506988466776016932371096431769938632047109251067442189638217128676113266041871321235204658472923613240444285664708485077091335081671331836904502373496885094285208081559500910423098818826289599276130508181760712176904360070909941692907834137402,
        0.300865438877677202667154094506988466776016932371096431769938632047109251067442189638217128676113266041871321235204658472923613240444285664708485077091335081671331836904502373496885094285208081559500910423098818826289599276130508181760712176904360070909941692907834137402,
        -0.324088435024413375183252279167455820204736321175114438942813843530622153389894732980004576617789573151109100168960521948195340553120611416021130868188605400254195543156457265781733737087316969444460040161188971083604781633072631616773084390560508714245608126100708456,
        0.324088435024413375183252279167455820204736321175114438942813843530622153389894732980004576617789573151109100168960521948195340553120611416021130868188605400254195543156457265781733737087316969444460040161188971083604781633072631616773084390560508714245608126100708456,
        -0.347117728597635508426162771971452430552397537887671522719107362074769438316065503450223408081531867763596904045694594880271049699971757148196155292273407048461979543996647022326249102839513226060888951602735431072322729949436253592304728980418854756671838122752026200328,
        0.347117728597635508426162771971452430552397537887671522719107362074769438316065503450223408081531867763596904045694594880271049699971757148196155292273407048461979543996647022326249102839513226060888951602735431072322729949436253592304728980418854756671838122752026200328,
        -0.369939555349859026616591741167647326588748645311520832099933400435229594917389062690185674142490986618624545583094251613443664397758469149556225981438111735806004743837947788606604669705565826781794520374738711692584185378426037122356166416907727011954306251557822260397,
        0.369939555349859026616591741167647326588748645311520832099933400435229594917389062690185674142490986618624545583094251613443664397758469149556225981438111735806004743837947788606604669705565826781794520374738711692584185378426037122356166416907727011954306251557822260397,
        -0.392540275033267442735648189122302040204880585609766559009786609676337015505333991263698674180650664347900733969350129821522648372443395038162344318634582946992052959465245390397817745860682505890946871134554747261269724468715895660887838955696362521273539698172077121535,
        0.392540275033267442735648189122302040204880585609766559009786609676337015505333991263698674180650664347900733969350129821522648372443395038162344318634582946992052959465245390397817745860682505890946871134554747261269724468715895660887838955696362521273539698172077121535,
        -0.414906379552275015492273879245961344194602307264323844113016013516812737652736312275691916330334498875798764802370972493904086381918059390850846672753827238467350937548756232809006355005725259332020412803676600671512938024792463031625138502895988214740594336796878063898,
        0.414906379552275015492273879245961344194602307264323844113016013516812737652736312275691916330334498875798764802370972493904086381918059390850846672753827238467350937548756232809006355005725259332020412803676600671512938024792463031625138502895988214740594336796878063898,
        -0.437024501037104162937042943417261582376157613488066656094743072219655410099121808240505465343347537946956837164511577288457149223818421826209275422560764031900113300923797526186051342736826245920248682865258470122417798230723217468814739945245354021366326626021155733174,
        0.437024501037104162937042943417261582376157613488066656094743072219655410099121808240505465343347537946956837164511577288457149223818421826209275422560764031900113300923797526186051342736826245920248682865258470122417798230723217468814739945245354021366326626021155733174,
        -0.458881419833552195449089130422706757538986626776781080020018863810543738054767079538852009588698801526317588214928645181274247260791414070145567879609179965563929923596006238173180266196462879095406824196630070591655228971762077633010105478681990919077457905808283002526,
        0.458881419833552195449089130422706757538986626776781080020018863810543738054767079538852009588698801526317588214928645181274247260791414070145567879609179965563929923596006238173180266196462879095406824196630070591655228971762077633010105478681990919077457905808283002526,
        -0.480464072404172025858275706671041846791433170124765224239272688938341564787725561333354586559466753986683893472151122697041533876844345875640523015322965410556839947562250908299399106406546513166858436012410078984143513045149867888295454675202465187469388641092646762654,
        0.480464072404172025858275706671041846791433170124765224239272688938341564787725561333354586559466753986683893472151122697041533876844345875640523015322965410556839947562250908299399106406546513166858436012410078984143513045149867888295454675202465187469388641092646762654,
        -0.501759559136144464289606293342111575734600562485027323391320102136254433671990540469325185384044462219047537122960529690195790764659666357378705219517863629948529221479858831031441315705927968264407274250372790669135315130434703681294441314855945496342121000098684301709,
        0.501759559136144464289606293342111575734600562485027323391320102136254433671990540469325185384044462219047537122960529690195790764659666357378705219517863629948529221479858831031441315705927968264407274250372790669135315130434703681294441314855945496342121000098684301709,
        -0.522755152051175478453947939495837379644881595486856961591398400954340593006744201141550441131481204718511161929558374462100603331809919392221704909345308389877884939512640712423846693343610877840558013369079437545463990915017960160443868116278010515744656395965535561627,
        0.522755152051175478453947939495837379644881595486856961591398400954340593006744201141550441131481204718511161929558374462100603331809919392221704909345308389877884939512640712423846693343610877840558013369079437545463990915017960160443868116278010515744656395965535561627,
        -0.543438302412810363444193627172078964540249946277274924520844190538202865516826612243026427588510879327248739002601629194438032270486197624953383956655873156123194658480641747706289105909199886344131051424603542767945628733382313998339517215659655912048917640261384012931,
        0.543438302412810363444193627172078964540249946277274924520844190538202865516826612243026427588510879327248739002601629194438032270486197624953383956655873156123194658480641747706289105909199886344131051424603542767945628733382313998339517215659655912048917640261384012931,
        -0.563796648226618083914430770208106017955493985054991147646351370724753485565639402614029973071115382943538294947871287315859503899254319161798760865178017678066418851102754810308320038860758701123376588960445574695418739843104754928787313253902554251686906488750252210874,
        0.563796648226618083914430770208106017955493985054991147646351370724753485565639402614029973071115382943538294947871287315859503899254319161798760865178017678066418851102754810308320038860758701123376588960445574695418739843104754928787313253902554251686906488750252210874,
        -0.583818021628763089550038857283899630863347124707354558086019471594293609733170257537547059839584360212115058494885965050131561892942143784238870668212705514378090291201052475319382761220712860470437269966558418544118138730586779807065089078809526786670978358825802164253,
        0.583818021628763089550038857283899630863347124707354558086019471594293609733170257537547059839584360212115058494885965050131561892942143784238870668212705514378090291201052475319382761220712860470437269966558418544118138730586779807065089078809526786670978358825802164253,
        -0.603490456158548624203573197530765985567606674355728021286407783059379393691177824412427139549946540966566054337065385671626800610435729575142981304768458385141251938943435632715318977698285419783281553448278433702508725821951022355867091174850453537352488699174089329963,
        0.603490456158548624203573197530765985567606674355728021286407783059379393691177824412427139549946540966566054337065385671626800610435729575142981304768458385141251938943435632715318977698285419783281553448278433702508725821951022355867091174850453537352488699174089329963,
        -0.622802193910584910761539598641005881050094921762621047923672515705200883450584432928933395448339854555055634302492142722345212818800790621589566948220245537885490514719978467433208458822226148167840594018854662904102282021538658416743116355831166426375039669146031147118,
        0.622802193910584910761539598641005881050094921762621047923672515705200883450584432928933395448339854555055634302492142722345212818800790621589566948220245537885490514719978467433208458822226148167840594018854662904102282021538658416743116355831166426375039669146031147118,
        -0.641741692562307557153524916177315400383414401407993561795227106190648337892331592033206622837122639680727135967519248982143870694407367532889103299203092740569950643110432673515057544619865289673057750937417345835217234489679786337727824359756339287767103866965387769176,
        0.641741692562307557153524916177315400383414401407993561795227106190648337892331592033206622837122639680727135967519248982143870694407367532889103299203092740569950643110432673515057544619865289673057750937417345835217234489679786337727824359756339287767103866965387769176,
        -0.66029763227264605210594683479069820842569247904164611314608989522532279730308528930695935607677447482140979116146310995525159660168193410910611418460447480779370821854092245893574104254880296306694624414717592218350171582797112737878825318701378825579472705430488232677,
        0.66029763227264605210594683479069820842569247904164611314608989522532279730308528930695935607677447482140979116146310995525159660168193410910611418460447480779370821854092245893574104254880296306694624414717592218350171582797112737878825318701378825579472705430488232677,
        -0.678458922447719259367755656704745585538303388182567793400902611475408698413198704637468198729150877923453544915979735883870995626369275868251483405895742817501501814832167649837074163505121369716062583878836664646744457577610785856574287446256030444685858734841391995744,
        0.678458922447719259367755656704745585538303388182567793400902611475408698413198704637468198729150877923453544915979735883870995626369275868251483405895742817501501814832167649837074163505121369716062583878836664646744457577610785856574287446256030444685858734841391995744,
        -0.696214708369514332385086602419347557005036443910190173435079714648280479581527574447589689365820515833862893703626525852245025414457461428580861157403806061674826382854751471307210521183729063113507653959821268814607639043647390273189320815108176685119379644240711216749,
        0.696214708369514332385086602419347557005036443910190173435079714648280479581527574447589689365820515833862893703626525852245025414457461428580861157403806061674826382854751471307210521183729063113507653959821268814607639043647390273189320815108176685119379644240711216749,
        -0.713554377683587413343859913030853876588845753615844157881172719229224135954987582282842632493408367413504570439571473653448251799396312533095074257737501138941601097371056266122509759332486214187995624104286081738758138608268233931107562979987665947091969451124019905946,
        0.713554377683587413343859913030853876588845753615844157881172719229224135954987582282842632493408367413504570439571473653448251799396312533095074257737501138941601097371056266122509759332486214187995624104286081738758138608268233931107562979987665947091969451124019905946,
        -0.730467566741908806471736942954439672208682711566285018915863667335222029805459201338882050471505599344931572764756265247453186569075324440199955408302224010776315165794462415761348735098173722092418056646834676824612447808832227079000761995821142829710750648613259066275,
        0.730467566741908806471736942954439672208682711566285018915863667335222029805459201338882050471505599344931572764756265247453186569075324440199955408302224010776315165794462415761348735098173722092418056646834676824612447808832227079000761995821142829710750648613259066275,
        -0.74694416679706198116988242143448880312162367930315067121408067356906959182156684474418242462793964278607096690029723862613692532854932154718989705185247817478766385323837333379140540503391006897705639302677313004370855171932612320353210537965085736371971032472518822418,
        0.74694416679706198116988242143448880312162367930315067121408067356906959182156684474418242462793964278607096690029723862613692532854932154718989705185247817478766385323837333379140540503391006897705639302677313004370855171932612320353210537965085736371971032472518822418,
        -0.76297433004409472277976914348633054844789455188070118600742970529006566489127978238274299822716835876881397686976654002337897158274251910405564425901303864817307494792600691723836483139790722652522219250899248639056420660959211353200760417887444615656289909206253750338,
        0.76297433004409472277976914348633054844789455188070118600742970529006566489127978238274299822716835876881397686976654002337897158274251910405564425901303864817307494792600691723836483139790722652522219250899248639056420660959211353200760417887444615656289909206253750338,
        -0.778548475506411966850494066699286050115550128884012830166869522466753382264460205197648444316930249361745757233817669678122266555850335510732284813247128127337678915631408151589823369773842482276785820209083762637965135075418966259966861375589156547002705808603626683621,
        0.778548475506411966850494066699286050115550128884012830166869522466753382264460205197648444316930249361745757233817669678122266555850335510732284813247128127337678915631408151589823369773842482276785820209083762637965135075418966259966861375589156547002705808603626683621,
        -0.793657294762193290243332946693806777795973646434017377536106355777437814060207863625944631128507063360908853176479314321501435252125004435460268117395631711587415637985410241844815552041312185035273889592922286858297672868723302674032032362980757565600418816680581551721,
        0.793657294762193290243332946693806777795973646434017377536106355777437814060207863625944631128507063360908853176479314321501435252125004435460268117395631711587415637985410241844815552041312185035273889592922286858297672868723302674032032362980757565600418816680581551721,
        -0.808291757507913660119642248581417287667297580715008491114035608833828980651496554482933930260186513343783210093403543173973513705449767694410493342425839860408516148580981284073712746797083416289952372708080493200614648346566213376937050721760414282499983469142182800721,
        0.808291757507913660119642248581417287667297580715008491114035608833828980651496554482933930260186513343783210093403543173973513705449767694410493342425839860408516148580981284073712746797083416289952372708080493200614648346566213376937050721760414282499983469142182800721,
        -0.822443116955643842464594185856362268839025412333847489137365849383955205785786925308729407358389413921053933341190504991773151053277665923829598604282669733232189117287527288174734374883811616662331499204127463137989817408333874225210632762755405993722012618089711840998,
        0.822443116955643842464594185856362268839025412333847489137365849383955205785786925308729407358389413921053933341190504991773151053277665923829598604282669733232189117287527288174734374883811616662331499204127463137989817408333874225210632762755405993722012618089711840998,
        -0.836102915060906847116875309813909133223281588689934469664877683731838202133836498985474706828249309039823643827514970544698557055603353253587211463901420702505269863879482398847857661159245739070550349962635204561659185190271844467312948894517344551173403019660069381877,
        0.836102915060906847116875309813909133223281588689934469664877683731838202133836498985474706828249309039823643827514970544698557055603353253587211463901420702505269863879482398847857661159245739070550349962635204561659185190271844467312948894517344551173403019660069381877,
        -0.849262987577968969163600128998579691638515379979737321922061963782463017063906626601325321125244957506341727105049063739671179773348717791627606845812127842463170630776554160134896553017370981685290843290680228656573911492818173341914497246022871184585572794428389422825,
        0.849262987577968969163600128998579691638515379979737321922061963782463017063906626601325321125244957506341727105049063739671179773348717791627606845812127842463170630776554160134896553017370981685290843290680228656573911492818173341914497246022871184585572794428389422825,
        -0.861915468939548460590632271595073843574707901968532341640833475850267169847704564824332243853395840980502544821175606713040153839750166925477855193923744721218952564978204942620293459783176665499294058977338994766837082573237578476856771428077184287526606918702174932392,
        0.861915468939548460590632271595073843574707901968532341640833475850267169847704564824332243853395840980502544821175606713040153839750166925477855193923744721218952564978204942620293459783176665499294058977338994766837082573237578476856771428077184287526606918702174932392,
        -0.874052796958031798695417954838269121229704050541220764069309941914883818148372772097549291699815923049481297918571705030974817815791723934210551156248366661990559958418196591116783694730146228123549357891528622689453614669555864665960758740817268391121297452895099510656,
        0.874052796958031798695417954838269121229704050541220764069309941914883818148372772097549291699815923049481297918571705030974817815791723934210551156248366661990559958418196591116783694730146228123549357891528622689453614669555864665960758740817268391121297452895099510656,
        -0.885667717345397217408292424532436356007954758886233012513576807762259808619095167696428627815906029883435454933985137882449878019200466385368549770698417916155712916749116714986933467957709642735239856401984605332295426937617471353113734844914736481479295582317735647451,
        0.885667717345397217408292424532436356007954758886233012513576807762259808619095167696428627815906029883435454933985137882449878019200466385368549770698417916155712916749116714986933467957709642735239856401984605332295426937617471353113734844914736481479295582317735647451,
        -0.896753288049158184386447397626046023752279336141358705880557566681363626339400313198916449376823295059874723468745436984262561065572405303867032915422337682099593264935746304464968480174710784642541740426885249641418716151593719300031264207125754655800916436663959695444,
        0.896753288049158184386447397626046023752279336141358705880557566681363626339400313198916449376823295059874723468745436984262561065572405303867032915422337682099593264935746304464968480174710784642541740426885249641418716151593719300031264207125754655800916436663959695444,
        -0.907302883401756813921485947489143658105747615213562681280629918970011949633052090688245100083062129212184227070230490517128621222115751011310808048411731852902713777021925864046000431878893245360139503454048039361426443559700940027501095767571482613540894179567637122748,
        0.907302883401756813921485947489143658105747615213562681280629918970011949633052090688245100083062129212184227070230490517128621222115751011310808048411731852902713777021925864046000431878893245360139503454048039361426443559700940027501095767571482613540894179567637122748,
        -0.917310198080960537036483580142165576286567265409790386882575853026050104265600887538951624325628828902178003382389437320550541419127842049764103806719960059993765853051811630883901189292328262520857198030633195115460086970018598685625776318115493750752819799187160080052,
        0.917310198080960537036483580142165576286567265409790386882575853026050104265600887538951624325628828902178003382389437320550541419127842049764103806719960059993765853051811630883901189292328262520857198030633195115460086970018598685625776318115493750752819799187160080052,
        -0.926769250878947843334624518174591143914581855423786063727617062634866400361824519628810605038344340501529946193032902003246985484834834006264669906204433256099915875692518878181214365438728975090908460073091446505143307295701192503702216063090300589581490043811425744084,
        0.926769250878947843334624518174591143914581855423786063727617062634866400361824519628810605038344340501529946193032902003246985484834834006264669906204433256099915875692518878181214365438728975090908460073091446505143307295701192503702216063090300589581490043811425744084,
        -0.935674388277916375783126754801419227404386989426772924133349974749301080279122007821610690499319930244042521341568301234061690795010580180817194110371685240405710022771652418369733322422885106391711222799446000458057655209035475831612650065502615382989547208596155898596,
        0.935674388277916375783126754801419227404386989426772924133349974749301080279122007821610690499319930244042521341568301234061690795010580180817194110371685240405710022771652418369733322422885106391711222799446000458057655209035475831612650065502615382989547208596155898596,
        -0.944020287830220182121111417900492273744269673875086005139137633642122104566393072834241393468436242836275032340302262074682594074934153510113987549424337823899964702093893910568355462860627729392571724962996713001536699894946099451207452111501974820231971015764896851739,
        0.944020287830220182121111417900492273744269673875086005139137633642122104566393072834241393468436242836275032340302262074682594074934153510113987549424337823899964702093893910568355462860627729392571724962996713001536699894946099451207452111501974820231971015764896851739,
        -0.951801961341264386217796301591956159344531563607041984886539856133605988988313028196394075555930874325184878417055631291810262287304016343129583184076427267078638352606845993345982183340034302943357554506341661819255977001835304247570004493021057966548099191808006240792,
        0.951801961341264386217796301591956159344531563607041984886539856133605988988313028196394075555930874325184878417055631291810262287304016343129583184076427267078638352606845993345982183340034302943357554506341661819255977001835304247570004493021057966548099191808006240792,
        -0.959014757853699928098918549973125079037819737371388652627687457707534940739083346291376634209357691268824819743590537658324059962620418963596344179283216773120242835811996193609397111563343706750039875679283293047627431430993767808545871114793560166995051919941155884385,
        0.959014757853699928098918549973125079037819737371388652627687457707534940739083346291376634209357691268824819743590537658324059962620418963596344179283216773120242835811996193609397111563343706750039875679283293047627431430993767808545871114793560166995051919941155884385,
        -0.965654366431965268645829026588804384555693505697268145010125594977774446383886567620363107852618818758612948652751286077771007072717438127905343821447681113562270543781890650138797935922481199549069969200106817148548857624891351907463019638775681096325416668487336999434,
        0.965654366431965268645829026588804384555693505697268145010125594977774446383886567620363107852618818758612948652751286077771007072717438127905343821447681113562270543781890650138797935922481199549069969200106817148548857624891351907463019638775681096325416668487336999434,
        -0.971716818747136580904338360183223835124025200970844082644596914338865727708025770278250623448058366375242339455508497626752846159815741216046940907635508563667119837726060824527728242883311667971476013900619005590985026043828151385116516715633030250274768180435285456883,
        0.971716818747136580904338360183223835124025200970844082644596914338865727708025770278250623448058366375242339455508497626752846159815741216046940907635508563667119837726060824527728242883311667971476013900619005590985026043828151385116516715633030250274768180435285456883,
        -0.977198491463907387165374426523317503136628419325752710457301064029455275855889877551007846662429394201951111393553598302616900184638848211053990688194564452272708779736406954541677689598420694214383097296982298587266546007707916474343877053587495036631691822794590782932,
        0.977198491463907387165374426523317503136628419325752710457301064029455275855889877551007846662429394201951111393553598302616900184638848211053990688194564452272708779736406954541677689598420694214383097296982298587266546007707916474343877053587495036631691822794590782932,
        -0.982096108435718536024765629891603926177146083773864144049441713059871455614961175264107787376347013338746488389379315787527496320478022135521466641299237829360216717967892089403086958281034774574299036593031559669481089949962521940059872046786799206761836411082882312709,
        0.982096108435718536024765629891603926177146083773864144049441713059871455614961175264107787376347013338746488389379315787527496320478022135521466641299237829360216717967892089403086958281034774574299036593031559669481089949962521940059872046786799206761836411082882312709,
        -0.986406742724586208871235519240487450536842392077915740022077473555726910203289997744922927955005238738940968425807674138686817278415809059920231291020016404952301027388324743864081872754187884623330796535630405489982296229463489310535616689878049818894413309419233201328,
        0.986406742724586208871235519240487450536842392077915740022077473555726910203289997744922927955005238738940968425807674138686817278415809059920231291020016404952301027388324743864081872754187884623330796535630405489982296229463489310535616689878049818894413309419233201328,
        -0.990127818491734383337930315471969789804584078149699112189801826483489742719447797385028658635198317329462939044324432069577114363806697145453895526602743393471662681969577834547050801830784949869125885536257716554775741644697531831973466701161783224325271134894621581075,
        0.990127818491734383337930315471969789804584078149699112189801826483489742719447797385028658635198317329462939044324432069577114363806697145453895526602743393471662681969577834547050801830784949869125885536257716554775741644697531831973466701161783224325271134894621581075,
        -0.993257112900212935303437221085991652348227395741262649655108974227489900423907219561798256445963439589072037869191205349821756688950899492324184600023902995047947259484613982356344953279695781703229076162231707046504627339943592672903932170081451716060823724514221265028,
        0.993257112900212935303437221085991652348227395741262649655108974227489900423907219561798256445963439589072037869191205349821756688950899492324184600023902995047947259484613982356344953279695781703229076162231707046504627339943592672903932170081451716060823724514221265028,
        -0.995792758534981186864161209620546416745438242147919390695365249661730546181629229420747381471609971305229774946731908603399901552864488420670817947155705175930174550137978823839690002265300777216177204520018218621710705648136002359014028533386227188360472347169478219527,
        0.995792758534981186864161209620546416745438242147919390695365249661730546181629229420747381471609971305229774946731908603399901552864488420670817947155705175930174550137978823839690002265300777216177204520018218621710705648136002359014028533386227188360472347169478219527,
        -0.997733248625514019882157443347699381411356666895566527802029461258993456388719043579175526781376962197434013986144634623735762800802132772657367414779730764919396640437975118544533207511056974597471447649504904417480092103311175577908215485645525409570079962465686316126,
        0.997733248625514019882157443347699381411356666895566527802029461258993456388719043579175526781376962197434013986144634623735762800802132772657367414779730764919396640437975118544533207511056974597471447649504904417480092103311175577908215485645525409570079962465686316126,
        -0.999077459977375895011987757683539829317590509795224875467931616085943028785276863849372541548578828154220769030087541048463373973710768415857708644912595641789665636560765877950539509953508597746932580903118602649199215697093594311387486069366277422779858424359074909757,
        0.999077459977375895011987757683539829317590509795224875467931616085943028785276863849372541548578828154220769030087541048463373973710768415857708644912595641789665636560765877950539509953508597746932580903118602649199215697093594311387486069366277422779858424359074909757,
        -0.999824887947131914473608082981874171601744075327476794038766265010742963678464988280307771674162503340720408203359510811827103761488989406689552734833603932187954032486183652398911309363961517992133461830614772707761474248773790353561027030886915015150939844674367692767,
        0.999824887947131914473608082981874171601744075327476794038766265010742963678464988280307771674162503340720408203359510811827103761488989406689552734833603932187954032486183652398911309363961517992133461830614772707761474248773790353561027030886915015150939844674367692767,
};


static long double w64[128] = {
        0.024446180196262518211325852610625955037918767945673708152236709651607460080647643427143916767398998050639592749080311067502133992108790580160343685150847366033769822305950066260987929498242155769801950626204281360399157440750427973463842360509746267800745430220795514814,
        0.024446180196262518211325852610625955037918767945673708152236709651607460080647643427143916767398998050639592749080311067502133992108790580160343685150847366033769822305950066260987929498242155769801950626204281360399157440750427973463842360509746267800745430220795514814,
        0.024431569097850045054848561428640429392839015282350815571582472928277158229743679978582954793234482995335176051172471830352525090257028556069061615833981581091797753056709265700929463191586039968506718031516846591638631552452837364862910652841123860916755181205569886043,
        0.024431569097850045054848561428640429392839015282350815571582472928277158229743679978582954793234482995335176051172471830352525090257028556069061615833981581091797753056709265700929463191586039968506718031516846591638631552452837364862910652841123860916755181205569886043,
        0.024402355633849582093297989694202810781534811017685917776872784227284526406467100978719653045618854054834374627600474523116393559214882728565899481560579288581214939931485531365012626573016208743523166871621703554171002974520586997020693447439908397200404188051985410543,
        0.024402355633849582093297989694202810781534811017685917776872784227284526406467100978719653045618854054834374627600474523116393559214882728565899481560579288581214939931485531365012626573016208743523166871621703554171002974520586997020693447439908397200404188051985410543,
        0.024358557264690625853268520246285787011468741362218989409494108967470391703304176670862121605271028482070268511962873642791933797710768092165748627603124549651812600004973759952086921577304976066243362086673405470311021556405174294697614694284918808976410255586033404872,
        0.024358557264690625853268520246285787011468741362218989409494108967470391703304176670862121605271028482070268511962873642791933797710768092165748627603124549651812600004973759952086921577304976066243362086673405470311021556405174294697614694284918808976410255586033404872,
        0.02430020016797186532344260636384271988452443481157325128625199660657173390937401030815270011681311056497422150730974154256316047067433551540326393697735804372870941064299303219970235282427590989833000973093897393048944429241869261271833894362919489564394988513999302808,
        0.02430020016797186532344260636384271988452443481157325128625199660657173390937401030815270011681311056497422150730974154256316047067433551540326393697735804372870941064299303219970235282427590989833000973093897393048944429241869261271833894362919489564394988513999302808,
        0.024227319222815248120093308441786261480677063972881856881647774222296024439454691900724355708521512994922068308677041964147926972036800347115067007229411661579965503957167617214127837047356774760114403992373011391631630822315873391580415832630342995630129468677762023296,
        0.024227319222815248120093308441786261480677063972881856881647774222296024439454691900724355708521512994922068308677041964147926972036800347115067007229411661579965503957167617214127837047356774760114403992373011391631630822315873391580415832630342995630129468677762023296,
        0.024139957989019284997716653890466234259679033836399858161920825819324140547670442555279858971249413767432541862494786613099392716590559744991765059615435417466445598260367604076589414057655337495544981012354394840444444729548589527988850328060272866876098423826901466577,
        0.024139957989019284997716653890466234259679033836399858161920825819324140547670442555279858971249413767432541862494786613099392716590559744991765059615435417466445598260367604076589414057655337495544981012354394840444444729548589527988850328060272866876098423826901466577,
        0.024038168681024052637587316819637861769680969551544145016606629972757393472447480026365091128775905084135913823405570211782572102451830067073119643342099373542142390259650759982194481705299011651017351318430057925342203658882323354767224860277687453203650225656536396786,
        0.024038168681024052637587316819637861769680969551544145016606629972757393472447480026365091128775905084135913823405570211782572102451830067073119643342099373542142390259650759982194481705299011651017351318430057925342203658882323354767224860277687453203650225656536396786,
        0.02392201213670345567245040881707188916111548545859341539348214625896045353440800846774304523594002435869864651056715647654365049329323674163229762022390869224963166240414435207192193502061754728139425406263588394409006752692123772131320754319558779501315361794272577159,
        0.02392201213670345567245040881707188916111548545859341539348214625896045353440800846774304523594002435869864651056715647654365049329323674163229762022390869224963166240414435207192193502061754728139425406263588394409006752692123772131320754319558779501315361794272577159,
        0.023791557781003400638780709885412780845746291577327825375592361694143044468497512318975463255913740380132258191274015764622711126124233966145958551644654749848800388387380450938501197727130572349158727619776150945798120587193459818410112415936200512954424398664211802554,
        0.023791557781003400638780709885412780845746291577327825375592361694143044468497512318975463255913740380132258191274015764622711126124233966145958551644654749848800388387380450938501197727130572349158727619776150945798120587193459818410112415936200512954424398664211802554,
        0.02364688358444761514365139230286627567526199158401651037196080900152706195847732427546856052318695588330777186847253405070080672908954992287124368339787071561352281382104721687026538774065372066204742472152437523794403757770447219939736994143633112619743013945321607224,
        0.02364688358444761514365139230286627567526199158401651037196080900152706195847732427546856052318695588330777186847253405070080672908954992287124368339787071561352281382104721687026538774065372066204742472152437523794403757770447219939736994143633112619743013945321607224,
        0.023488076016535913153025273281787309284165894037039095168847228664330566785329484250891957705410814769086708377238485732526373003949136411500428658421577708153340006204372401839970147062294121996869526602705399944182111789080409351381076393912550243794368678926418214896,
        0.023488076016535913153025273281787309284165894037039095168847228664330566785329484250891957705410814769086708377238485732526373003949136411500428658421577708153340006204372401839970147062294121996869526602705399944182111789080409351381076393912550243794368678926418214896,
        0.023315229994062760122415671272798263467294736305391037133657661424679806372899327584876703276929476264375666192537129231636686733607559204326357265193275033931770797345441186869982349050825441743129161239927097968780867778612242530757048268940943952997864075362381943177,
        0.023315229994062760122415671272798263467294736305391037133657661424679806372899327584876703276929476264375666192537129231636686733607559204326357265193275033931770797345441186869982349050825441743129161239927097968780867778612242530757048268940943952997864075362381943177,
        0.023128448824387027879297902402767927682126218286279951845487388745252816496699392007475778873882622516080853932297256592306297805809774126625415009228661211647444315265833329438951243073878201341001136161639603683125885087902742933562025611703246408695703866483214232422,
        0.023128448824387027879297902402767927682126218286279951845487388745252816496699392007475778873882622516080853932297256592306297805809774126625415009228661211647444315265833329438951243073878201341001136161639603683125885087902742933562025611703246408695703866483214232422,
        0.022927844143686846920410987209321399316543482850894212983126107756573768856443435483034217482975440793459808202168688924386348385931513053608099449430682756873265254887438196794641331378010273695490097559298594833274381974047334336338327327308461702401302247287819130526,
        0.022927844143686846920410987209321399316543482850894212983126107756573768856443435483034217482975440793459808202168688924386348385931513053608099449430682756873265254887438196794641331378010273695490097559298594833274381974047334336338327327308461702401302247287819130526,
        0.02271353585023646130971263592293076920283867866606650738421069019340033526650127434355858741893815060753247821447976919008882058939384059086623153341336406605338580815939503415646568621759422949020040534411382382936935498095197973573513600156502070073186544994526431811,
        0.02271353585023646130971263592293076920283867866606650738421069019340033526650127434355858741893815060753247821447976919008882058939384059086623153341336406605338580815939503415646568621759422949020040534411382382936935498095197973573513600156502070073186544994526431811,
        0.022485652032744966871824603940587874279278950961162572174100946277226257673437960618229430870049635823890535132478105910205279705871207212912525131417713014791704388002253474277590324974400468851056568549722090102046859094972491210623862735629629784571046390607766252373,
        0.022485652032744966871824603940587874279278950961162572174100946277226257673437960618229430870049635823890535132478105910205279705871207212912525131417713014791704388002253474277590324974400468851056568549722090102046859094972491210623862735629629784571046390607766252373,
        0.022244328893799765104629133607198011273672500908647944787914969548311318107440282639076695295673473256347704680006120602593807519976410753616632669649337032295805357926888835401466765157978734509966656457330214373278394711552287941704463058241267488594968480266036419637,
        0.022244328893799765104629133607198011273672500908647944787914969548311318107440282639076695295673473256347704680006120602593807519976410753616632669649337032295805357926888835401466765157978734509966656457330214373278394711552287941704463058241267488594968480266036419637,
        0.021989710668460491434122106599160802097008471879708893629849300243534359089401296208854398325024158892036857360988671117330564608415239523888899631568438365448498635408069410722253804494825769823590731854348235210442221099611189537700301330096426966454049349224955162817,
        0.021989710668460491434122106599160802097008471879708893629849300243534359089401296208854398325024158892036857360988671117330564608415239523888899631568438365448498635408069410722253804494825769823590731854348235210442221099611189537700301330096426966454049349224955162817,
        0.021721949538052075375260957767613595354309856020916601469994366774564383162271658378209409988195914317155628412726093118604408429846867557103616825627819706553424159652112265416882679294243665756982388321516066407897177690716355587988235638576659712570068147444982151331,
        0.021721949538052075375260957767613595354309856020916601469994366774564383162271658378209409988195914317155628412726093118604408429846867557103616825627819706553424159652112265416882679294243665756982388321516066407897177690716355587988235638576659712570068147444982151331,
        0.021441205539208460137111853878016634104745086920951226453889117955981474700794074714487431282735245428331883285032179092353837529767806322080973649244257252871894095073955070277567523929290146991641455611986701028026684402912248566568424126113037161403106858091324818913,
        0.021441205539208460137111853878016634104745086920951226453889117955981474700794074714487431282735245428331883285032179092353837529767806322080973649244257252871894095073955070277567523929290146991641455611986701028026684402912248566568424126113037161403106858091324818913,
        0.021147646468221348537019535180397345324182142936904412655608995085544374379175003720805232535287057210036725756559810353500918328798288656268841724109064623834847821943597790320170720481015917869096616643319819885103730047300427980780203408890767120149472578714985146142,
        0.021147646468221348537019535180397345324182142936904412655608995085544374379175003720805232535287057210036725756559810353500918328798288656268841724109064623834847821943597790320170720481015917869096616643319819885103730047300427980780203408890767120149472578714985146142,
        0.020841447780751149113583948422898441646777329108909874691497009910944161474928283630300941830894357608372862590167606505939221298376571036393708553168243631022276262694964790870710069672028186084865423893972341517775294656849674686956836225766830506760361786246258610978,
        0.020841447780751149113583948422898441646777329108909874691497009910944161474928283630300941830894357608372862590167606505939221298376571036393708553168243631022276262694964790870710069672028186084865423893972341517775294656849674686956836225766830506760361786246258610978,
        0.020522792486960069432284967788161172230369232066835552249346516726706389647007191461875628030551043331486936587519927978273538699464787672691173862342235052875069709052739330734027905841108100318758873788388987965304072859178224095070850019291397535757989172170984121023,
        0.020522792486960069432284967788161172230369232066835552249346516726706389647007191461875628030551043331486936587519927978273538699464787672691173862342235052875069709052739330734027905841108100318758873788388987965304072859178224095070850019291397535757989172170984121023,
        0.020191871042130041180673158406118351162483724196615380306866630817066802620726821781821333341035690384097119776286050851356363370586175585424240921500112338935076312216856185767917412843686942874416239590773406392603954333772019382455745575306722168174770762821993110192,
        0.020191871042130041180673158406118351162483724196615380306866630817066802620726821781821333341035690384097119776286050851356363370586175585424240921500112338935076312216856185767917412843686942874416239590773406392603954333772019382455745575306722168174770762821993110192,
        0.019848881232830862219944413264876536494784856691682978158576218609857056544238591103918020738418587598348352368142854586301282745427869063954973034917924556593299474971913015735181169096913398310981806368066935196729132422781414382665939997139422778154504346963570397637,
        0.019848881232830862219944413264876536494784856691682978158576218609857056544238591103918020738418587598348352368142854586301282745427869063954973034917924556593299474971913015735181169096913398310981806368066935196729132422781414382665939997139422778154504346963570397637,
        0.019494028058706602823021918681215506948859287576991729309915501157759912078008777712598435596130433312567965024986854647763376930090071426603719093809216259928237165205541827346445425913518437603564851957829812170873594718032606309538956145562962662423683061864317423165,
        0.019494028058706602823021918681215506948859287576991729309915501157759912078008777712598435596130433312567965024986854647763376930090071426603719093809216259928237165205541827346445425913518437603564851957829812170873594718032606309538956145562962662423683061864317423165,
        0.019127523609950945486518531667840458415537967185370450699261364245294865850550565902367722722911418788143380369255152713838845456318682101205647164519563433821255372645937369356846404317238443175996590271608338183896604114257741978310073271324988707088382992713255413991,
        0.019127523609950945486518531667840458415537967185370450699261364245294865850550565902367722722911418788143380369255152713838845456318682101205647164519563433821255372645937369356846404317238443175996590271608338183896604114257741978310073271324988707088382992713255413991,
        0.018749586940544708650919548473844607845372398508998659019670240850326501929481184526140489523572817021855261356859116119058078952356474917982754013580330383256850053313104861594166163326674884357789421249043446620976516809197949297778056271395178440823124498154387380508,
        0.018749586940544708650919548473844607845372398508998659019670240850326501929481184526140489523572817021855261356859116119058078952356474917982754013580330383256850053313104861594166163326674884357789421249043446620976516809197949297778056271395178440823124498154387380508,
        0.018360443937331343221289290991304755097143822544693084820939024433848229253555503882135522749482638620243535003740929963408303101654598355307295747830507188826477721847508457595902229106971139479867247493193068919476783510835714261180795942878465838537598833661863429295,
        0.018360443937331343221289290991304755097143822544693084820939024433848229253555503882135522749482638620243535003740929963408303101654598355307295747830507188826477721847508457595902229106971139479867247493193068919476783510835714261180795942878465838537598833661863429295,
        0.01796032718500868594019692752496828902976362745663299667780857139388064655072598553114217016494179504251865411623884404501177952026281203368040234058673013103197935390056758888322782620439989429492523885265648154644358504704390834310581259193677420711125361570037208517,
        0.01796032718500868594019692752496828902976362745663299667780857139388064655072598553114217016494179504251865411623884404501177952026281203368040234058673013103197935390056758888322782620439989429492523885265648154644358504704390834310581259193677420711125361570037208517,
        0.017549475827117704648706925634375749319071169980621262223025426141575660976319511442783761932852667103731800917909319710559873067414989394616586051676899503888706871031799496492335363131865866644135271698698696908017278203794847671303609618499960065463921758389274957524,
        0.017549475827117704648706925634375749319071169980621262223025426141575660976319511442783761932852667103731800917909319710559873067414989394616586051676899503888706871031799496492335363131865866644135271698698696908017278203794847671303609618499960065463921758389274957524,
        0.017128135423111376830680987618846443151771785985967585588562909941352179025694788326828355691743811391394320845581007300242074379888939285890340561667649505135586896064332296553669886259396913188586251264859079340254303968595660944242019053171818671238961107796602609908,
        0.017128135423111376830680987618846443151771785985967585588562909941352179025694788326828355691743811391394320845581007300242074379888939285890340561667649505135586896064332296553669886259396913188586251264859079340254303968595660944242019053171818671238961107796602609908,
        0.016696557801589204589091507953798859173534808981362042888546285357096977231732749416959137269977234902401186765745580601976430866112490050574693502353726743377596248947426020764519186639934171824965824058913929600763586043123796606468673110438502032011500067172979554715,
        0.016696557801589204589091507953798859173534808981362042888546285357096977231732749416959137269977234902401186765745580601976430866112490050574693502353726743377596248947426020764519186639934171824965824058913929600763586043123796606468673110438502032011500067172979554715,
        0.016255000909785187051657456477058006863287781029795833699026070305798319758715351431738805996085071524713007254869096070229863185561780832005085653461869248488156225517113032672899601014474971836739523947859267383547353055147931830910424510510275084946035614956782634388,
        0.016255000909785187051657456477058006863287781029795833699026070305798319758715351431738805996085071524713007254869096070229863185561780832005085653461869248488156225517113032672899601014474971836739523947859267383547353055147931830910424510510275084946035614956782634388,
        0.015803728659399346858965631687381272704802592133762115662273265083578796312172066726619218876415968178188318401304969143010098259535484896821440400904056221614628596737139216639948474323380380072039887693866091210030185731771604257283268262433729685403378958695573547797,
        0.015803728659399346858965631687381272704802592133762115662273265083578796312172066726619218876415968178188318401304969143010098259535484896821440400904056221614628596737139216639948474323380380072039887693866091210030185731771604257283268262433729685403378958695573547797,
        0.015343010768865144085990853741436749596772591755222408893199199274636952203673081569722246679089992090592256219897339855677129600499863034152770915614063219416163975558033196364488448433320010320707262374710039910826954999802774228023990941899838240543458611767323493561,
        0.015343010768865144085990853741436749596772591755222408893199199274636952203673081569722246679089992090592256219897339855677129600499863034152770915614063219416163975558033196364488448433320010320707262374710039910826954999802774228023990941899838240543458611767323493561,
        0.014873122602147314252385498520077286572909706413294737080241748186702714496603226962330810368862350921933177163425907329946620853350559621726966562364869835314181292142654740225783150758145777107243726024723744689643759158223243531154650432369015028939087898734557023553,
        0.014873122602147314252385498520077286572909706413294737080241748186702714496603226962330810368862350921933177163425907329946620853350559621726966562364869835314181292142654740225783150758145777107243726024723744689643759158223243531154650432369015028939087898734557023553,
        0.014394345004166846176823892008535995018806019661168672229684632226820967634278780262906115623665515105101546240295739616973350810882395749494114538995479283345975230313730079452162657022757792899488084240347243921069059708102295905486498232015691409241163963623871665254,
        0.014394345004166846176823892008535995018806019661168672229684632226820967634278780262906115623665515105101546240295739616973350810882395749494114538995479283345975230313730079452162657022757792899488084240347243921069059708102295905486498232015691409241163963623871665254,
        0.01390696413295198524428800739560630903287709112507536210250375146705816035474366644753775842078010156779430780354979268313658249855418329351329923888693177883187212395432112199632447849481206862124383791608984330268730891377171306159222548878324519475211988979072594262,
        0.01390696413295198524428800739560630903287709112507536210250375146705816035474366644753775842078010156779430780354979268313658249855418329351329923888693177883187212395432112199632447849481206862124383791608984330268730891377171306159222548878324519475211988979072594262,
        0.013411271288616332314488951616165177066595027643042108719198954538462830098410837707110190489004015275401360912025383587172862476293636467795936288702468917321217224821433873572081647577929226237675507503373649122439269292529818891576689626682715603373192873174159696384,
        0.013411271288616332314488951616165177066595027643042108719198954538462830098410837707110190489004015275401360912025383587172862476293636467795936288702468917321217224821433873572081647577929226237675507503373649122439269292529818891576689626682715603373192873174159696384,
        0.012907562739267347220442834003863646853505426045447760033517688607603198803770122000823040290695587935015217900404803682076527342331646116603372980989814522880898759450657407578664203121392203830061511233340208694499698852760392327218246962913578938590622047480254523556,
        0.012907562739267347220442834003863646853505426045447760033517688607603198803770122000823040290695587935015217900404803682076527342331646116603372980989814522880898759450657407578664203121392203830061511233340208694499698852760392327218246962913578938590622047480254523556,
        0.012396139543950922968821728197323653201115775998403273318829649723055529857495826309941616279618345339571301829629365274283627429369930296194267271948939310917009009243990484979413831933763651400932864525223152273233227565113455213671648044359547496393974103385469487487,
        0.012396139543950922968821728197323653201115775998403273318829649723055529857495826309941616279618345339571301829629365274283627429369930296194267271948939310917009009243990484979413831933763651400932864525223152273233227565113455213671648044359547496393974103385469487487,
        0.011877307372740279575891106925578207382135966559841611851511420041866607063494964505492419137590920627048131280625398662395541742313223085298259252343361868055585867598322033810446093642628656410827136758368985035248500309634523919684753852547063521962918638583123076963,
        0.011877307372740279575891106925578207382135966559841611851511420041866607063494964505492419137590920627048131280625398662395541742313223085298259252343361868055585867598322033810446093642628656410827136758368985035248500309634523919684753852547063521962918638583123076963,
        0.011351376324080416693281668452537309619247260467524551358321365565111007698703137966456231926604731505985904848513534853312583319308501689468874994767352326187684923093876814238750707203182570664008792445856474529717665776199802485354208887278709337289527114722390958711,
        0.011351376324080416693281668452537309619247260467524551358321365565111007698703137966456231926604731505985904848513534853312583319308501689468874994767352326187684923093876814238750707203182570664008792445856474529717665776199802485354208887278709337289527114722390958711,
        0.010818660739503076247659646277468898739482425189168921458055421826338242941241885921191011317217911262437588053439081416249383650976613629720105884473404658763157742317677526924043352453396934426078957806365375847222373323667486066680612046884463177667654432926245633924,
        0.010818660739503076247659646277468898739482425189168921458055421826338242941241885921191011317217911262437588053439081416249383650976613629720105884473404658763157742317677526924043352453396934426078957806365375847222373323667486066680612046884463177667654432926245633924,
        0.010279479015832157133215340326385369525777888955346886847354286982482423649945317424177027138061046083864617199747633287222707097306034452420051114334245905999682800067590148224816168995003038383982861292110326070130363544635956226937150390412053959457039813663195185888,
        0.010279479015832157133215340326385369525777888955346886847354286982482423649945317424177027138061046083864617199747633287222707097306034452420051114334245905999682800067590148224816168995003038383982861292110326070130363544635956226937150390412053959457039813663195185888,
        0.009734153415006805863548266093558904725135658662329528206675045215821514033045138045997652376528853969744298032016273513486844361003809536393148386035336889541279860051739418817312487414181786251900997731487970865318026080392327733247736875056009312782345728857960446576,
        0.009734153415006805863548266093558904725135658662329528206675045215821514033045138045997652376528853969744298032016273513486844361003809536393148386035336889541279860051739418817312487414181786251900997731487970865318026080392327733247736875056009312782345728857960446576,
        0.009183009871660874334478743688426683229364709822270154919895075730695922624872459343436886019795781486378767610249847988522242636458146327670750119585582190781022956746814268992864170787836242413308519830448624287432903949802109974540666528024763527329576508662417383968,
        0.009183009871660874334478743688426683229364709822270154919895075730695922624872459343436886019795781486378767610249847988522242636458146327670750119585582190781022956746814268992864170787836242413308519830448624287432903949802109974540666528024763527329576508662417383968,
        0.008626377798616749704978843781968439645213758671879879863614695904770808324566207077857951569769575939594134620182582114137917033741229913152590356882740813815071491912204073861366347676201678372918742251218084428129820849389576123977924576264206483146277039984992504167,
        0.008626377798616749704978843781968439645213758671879879863614695904770808324566207077857951569769575939594134620182582114137917033741229913152590356882740813815071491912204073861366347676201678372918742251218084428129820849389576123977924576264206483146277039984992504167,
        0.008064589890486057972928598697862961059352772972679980075112271688017479415284584092880684926295960310534074363657303468883632471100960306735595793338993567881073415377439551292823352601979690077745372456245858915251259373732361650420157637216667991080176246510450715556,
        0.008064589890486057972928598697862961059352772972679980075112271688017479415284584092880684926295960310534074363657303468883632471100960306735595793338993567881073415377439551292823352601979690077745372456245858915251259373732361650420157637216667991080176246510450715556,
        0.007497981925634728687671962688470164830852999842394944190727258444633058602858027770415294492209631987716581934273235330640158794083598414536853152504576715711900250629995441686678108157055295391169952755751528805880921451306321314280886304853579919523685029622756988606,
        0.007497981925634728687671962688470164830852999842394944190727258444633058602858027770415294492209631987716581934273235330640158794083598414536853152504576715711900250629995441686678108157055295391169952755751528805880921451306321314280886304853579919523685029622756988606,
        0.006926892566898813563426670360328775274960277031458902518860602396575469067785127513450080612064411259588126239571494080375524681298669865274794298727004666549691470379729830307483683055472176962768910074036035360090743791940524762984333744444167976805150983069064392494,
        0.006926892566898813563426670360328775274960277031458902518860602396575469067785127513450080612064411259588126239571494080375524681298669865274794298727004666549691470379729830307483683055472176962768910074036035360090743791940524762984333744444167976805150983069064392494,
        0.006351663161707188787214327826231292791641079277515076260142682099532743996960920935736556934174701186154643220151278543883794634956231801821252698771579582474241053531503679324586347769151144786091982396508280453637855574863148694751822105925993278127012030869427596774,
        0.006351663161707188787214327826231292791641079277515076260142682099532743996960920935736556934174701186154643220151278543883794634956231801821252698771579582474241053531503679324586347769151144786091982396508280453637855574863148694751822105925993278127012030869427596774,
        0.005772637542865698589334617626067639433441723938684726197123065729113680805435205358516579212255977550321868406448127286247296134245066322629566821155701975831138010993092861143133885754682654107739572921826110176794416655911313614558446174240766573622867822146962418217,
        0.005772637542865698589334617626067639433441723938684726197123065729113680805435205358516579212255977550321868406448127286247296134245066322629566821155701975831138010993092861143133885754682654107739572921826110176794416655911313614558446174240766573622867822146962418217,
        0.005190161832676330205070767134849455858865807752155673342621136004638032117423315390773971449031344587367940017430049117034077401286974961522447062442993751124476797474588335630704251766674203496528721707740989378486052319431317361988357137721362458675161835771553080296,
        0.005190161832676330205070767134849455858865807752155673342621136004638032117423315390773971449031344587367940017430049117034077401286974961522447062442993751124476797474588335630704251766674203496528721707740989378486052319431317361988357137721362458675161835771553080296,
        0.004604584256702955118290541980284688487367886955549523104321235111898337643978569797313778283768038416185440806237561513315980467174804520852940731038771709353465170432981850619843570052109740255586802133836104708996808258823088980952976198839694917261522765331000530633,
        0.004604584256702955118290541980284688487367886955549523104321235111898337643978569797313778283768038416185440806237561513315980467174804520852940731038771709353465170432981850619843570052109740255586802133836104708996808258823088980952976198839694917261522765331000530633,
        0.004016254983738642313194343486303099630043287487867404687343677847013808542955716023018998516329101712566359031986132574561657868948453512528398651198642481226040486410890560033054446940829246355750967756093001694138114756800942971620776660500669169712824259890421003228,
        0.004016254983738642313194343486303099630043287487867404687343677847013808542955716023018998516329101712566359031986132574561657868948453512528398651198642481226040486410890560033054446940829246355750967756093001694138114756800942971620776660500669169712824259890421003228,
        0.003425526040910215774337784660133170120458029483420180188352098501500033652054923454185619333575762235424682885838751468019489327592010696153963645171105056271342091884706239853103259931869693027653011387397960043814368187874784878165650497938351912365604379245824010519,
        0.003425526040910215774337784660133170120458029483420180188352098501500033652054923454185619333575762235424682885838751468019489327592010696153963645171105056271342091884706239853103259931869693027653011387397960043814368187874784878165650497938351912365604379245824010519,
        0.002832751471457991095285734646819059262048865113660043485689278719412812171885597277200611109086366854579579923118336951952715135864250875729046547072708150531155078614675333135912142587456716327855625855368061721711288825657693840502756967528135727337030038482815574223,
        0.002832751471457991095285734646819059262048865113660043485689278719412812171885597277200611109086366854579579923118336951952715135864250875729046547072708150531155078614675333135912142587456716327855625855368061721711288825657693840502756967528135727337030038482815574223,
        0.002238288430962618743622054272715903221939868106103776039234813739720885399374878724925537389546758236773145723377161967675487556535588424040598015190761240764596218839896715128403061443935689429730109737678236744235317688222183268496509408618179350022068842415031523293,
        0.002238288430962618743622054272715903221939868106103776039234813739720885399374878724925537389546758236773145723377161967675487556535588424040598015190761240764596218839896715128403061443935689429730109737678236744235317688222183268496509408618179350022068842415031523293,
        0.001642503018669029538790875594798066549305112117089350630872339670368710340790913280059866597815669062391059502360407407470853936293376198009853506648210330356961814766984477561148081733918367967738329224518861077587385708191186489437499816553371798786211649230030028732,
        0.001642503018669029538790875594798066549305112117089350630872339670368710340790913280059866597815669062391059502360407407470853936293376198009853506648210330356961814766984477561148081733918367967738329224518861077587385708191186489437499816553371798786211649230030028732,
        0.001045812679340348779312851600106983846290519784834523780839810520806038160479746855451045528385161891904201827186525830785207323101816933600313610561451256488325427576291565392030880814270597839499363773748009525598457802657519782164271987188128884706172777557926804029,
        0.001045812679340348779312851600106983846290519784834523780839810520806038160479746855451045528385161891904201827186525830785207323101816933600313610561451256488325427576291565392030880814270597839499363773748009525598457802657519782164271987188128884706172777557926804029,
        0.000449380960292090376394292239988722654319453544101743536506367240636681403145188246343309306136834295149301467224352804834523891157037624816016198050381583626399668766008226696517942106956189851422929335900623001698400429405657683897806956063674203833118760410954466748,
        0.000449380960292090376394292239988722654319453544101743536506367240636681403145188246343309306136834295149301467224352804834523891157037624816016198050381583626399668766008226696517942106956189851422929335900623001698400429405657683897806956063674203833118760410954466748,
};


//static long double x64[64] = {	-0.0323801709628693620333222431521344420459628023615180924250032200173778192033824263362735606192681682400367095349344164805253339336387227562143033309933613048005985693434381987818201481883459708779882194210519641874072840153368237061052666187976157919313172960863861628381000595094587588988,
//                                  0.0323801709628693620333222431521344420459628023615180924250032200173778192033824263362735606192681682400367095349344164805253339336387227562143033309933613048005985693434381987818201481883459708779882194210519641874072840153368237061052666187976157919313172960863861628381000595094587588988,
//                                  -0.097004699209462698930053955853624520152736229300936986430580765944804036262622285099333696696838482251782946732767916338280146687215461892885262614507377477016216369626353734517704634998485497845287278557096944336844633510368214754716443206792414853127255583775294604837750153713907779125,
//                                  0.097004699209462698930053955853624520152736229300936986430580765944804036262622285099333696696838482251782946732767916338280146687215461892885262614507377477016216369626353734517704634998485497845287278557096944336844633510368214754716443206792414853127255583775294604837750153713907779125,
//                                  -0.1612223560688917180564373907834976947743743797418951177032426375565163420995818327669417213304078905047469289913643484865687644250612355007927116617795075726826856211319024099286480529947830675509681216099789241579986072883173180183756777641306119014248393198804021443734101953272478086356,
//                                  0.1612223560688917180564373907834976947743743797418951177032426375565163420995818327669417213304078905047469289913643484865687644250612355007927116617795075726826856211319024099286480529947830675509681216099789241579986072883173180183756777641306119014248393198804021443734101953272478086356,
//                                  -0.2247637903946890612248654401746922774385618040416548061647426410451819418975142321008966769832523968757738085925020813633283546171689855524749511386953518352781265890518521436423483793631580745438946344313218704432914437669009715424118067933691427706349189683644822963043496308070736548139,
//                                  0.2247637903946890612248654401746922774385618040416548061647426410451819418975142321008966769832523968757738085925020813633283546171689855524749511386953518352781265890518521436423483793631580745438946344313218704432914437669009715424118067933691427706349189683644822963043496308070736548139,
//                                  -0.287362487355455576735886461316797687851558305801039778908500032168999844268762601001704292339961272995214058625810091249868879016571972602501163638980369411897516808779888097191828724252681176366227012075027580894573518833825847931483730601352532268455529624894259912734014534581597096756,
//                                  0.287362487355455576735886461316797687851558305801039778908500032168999844268762601001704292339961272995214058625810091249868879016571972602501163638980369411897516808779888097191828724252681176366227012075027580894573518833825847931483730601352532268455529624894259912734014534581597096756,
//                                  -0.3487558862921607381598179372704079161343096499683925760321229677812815940686757361857953413104847160280374576428630687758267800894381499018788076584644599829594877130739163145564793679207454032995884311111581358032893511567524785194776052845563074850934900960282532026840979559791515974264,
//                                  0.3487558862921607381598179372704079161343096499683925760321229677812815940686757361857953413104847160280374576428630687758267800894381499018788076584644599829594877130739163145564793679207454032995884311111581358032893511567524785194776052845563074850934900960282532026840979559791515974264,
//                                  -0.4086864819907167299162254958146332864599228429948880647711509833256205384841291116873915805142899986436114737684448709470307082779870061618597920932084296118862076288434792491643583952570621779678917397973976535200724285667082169336308347928155411376922203813637738684403894770306209513414,
//                                  0.4086864819907167299162254958146332864599228429948880647711509833256205384841291116873915805142899986436114737684448709470307082779870061618597920932084296118862076288434792491643583952570621779678917397973976535200724285667082169336308347928155411376922203813637738684403894770306209513414,
//                                  -0.4669029047509584045449288616507985092368121042585169441818691951347943934426041117896321899521249367540958369808560023408894000301389595681966323964992646011965161709344802230996956836398402865779629217552653963315941245332943404605356160774030036035812901620845357937981663968567270001267,
//                                  0.4669029047509584045449288616507985092368121042585169441818691951347943934426041117896321899521249367540958369808560023408894000301389595681966323964992646011965161709344802230996956836398402865779629217552653963315941245332943404605356160774030036035812901620845357937981663968567270001267,
//                                  -0.5231609747222330336782258691375085262891876218118841075802295472194144547473478378097802191241734396997924509742898611580628879308282360293385903809815567379534023934251408600146505859712141453532895311600963821788438898409406964154220798487081205986934867979553730903344355531319706864088,
//                                  0.5231609747222330336782258691375085262891876218118841075802295472194144547473478378097802191241734396997924509742898611580628879308282360293385903809815567379534023934251408600146505859712141453532895311600963821788438898409406964154220798487081205986934867979553730903344355531319706864088,
//                                  -0.5772247260839727038178092385404787728539972861401955280523973994277369963343625345949080176332758354499599142004845406197732474905562060699217319563779455006245105319191336263054840156749477295988855140896170934557051892106170295081164928959752697217727905252899776063732625007412660506619,
//                                  0.5772247260839727038178092385404787728539972861401955280523973994277369963343625345949080176332758354499599142004845406197732474905562060699217319563779455006245105319191336263054840156749477295988855140896170934557051892106170295081164928959752697217727905252899776063732625007412660506619,
//                                  -0.6288673967765136239951649330699946520249089997901617709817329945195319139770730440009534690880035500729300617461673600043305587317176931496094779552836108942993260952954280025686861022963859059310235981795207019884581242390756356185126160144595772809088950477447408497428058463581093785584,
//                                  0.6288673967765136239951649330699946520249089997901617709817329945195319139770730440009534690880035500729300617461673600043305587317176931496094779552836108942993260952954280025686861022963859059310235981795207019884581242390756356185126160144595772809088950477447408497428058463581093785584,
//                                  -0.677872379632663905211851280675909058849954679026048613071040642975494646879817410787234779026949520681001012272404115964909412280970787148918283989881918558113321844034245504998189305757207944538995185072701494950200354489606220674407089575379844746721958854047082743699334465743405516822,
//                                  0.677872379632663905211851280675909058849954679026048613071040642975494646879817410787234779026949520681001012272404115964909412280970787148918283989881918558113321844034245504998189305757207944538995185072701494950200354489606220674407089575379844746721958854047082743699334465743405516822,
//                                  -0.7240341309238146546744822334936652465850928122807223627293663025733514606200897197132835750604891104577518163120484582658800174693895509966659219730140279189488412561175044248435340666400502162020648032487714907667210819493361875857045126469933874318152853045476429683539190650865146845639,
//                                  0.7240341309238146546744822334936652465850928122807223627293663025733514606200897197132835750604891104577518163120484582658800174693895509966659219730140279189488412561175044248435340666400502162020648032487714907667210819493361875857045126469933874318152853045476429683539190650865146845639,
//                                  -0.7671590325157403392538554375229690536226423308482073722351285886640508368078610297555027042768830402396101913017961342648732426625507709974969886151874238882108460464288721776828310372261641739074723240066262844153885144216683911191793788609618554564855052572641464561624936660643716516963,
//                                  0.7671590325157403392538554375229690536226423308482073722351285886640508368078610297555027042768830402396101913017961342648732426625507709974969886151874238882108460464288721776828310372261641739074723240066262844153885144216683911191793788609618554564855052572641464561624936660643716516963,
//                                  -0.8070662040294426270825530430245384459730130294604153865758629418121821540044306528587505494693216399795084724684038764786660391153451303785346325829879169125179637179869502449038944186766189389960620284319019575168462640669335900176796578621694063718586615677186853319526889558837795931212,
//                                  0.8070662040294426270825530430245384459730130294604153865758629418121821540044306528587505494693216399795084724684038764786660391153451303785346325829879169125179637179869502449038944186766189389960620284319019575168462640669335900176796578621694063718586615677186853319526889558837795931212,
//                                  -0.8435882616243935307110898445196560498708870117375524015149131998988410546898537440620409553769606902806958167048591938845025015179542687623201124666205126284766684526602482974072107496385950974545043261329552934262890456054327356228832079667667563851644669620122005574187684259483704883944,
//                                  0.8435882616243935307110898445196560498708870117375524015149131998988410546898537440620409553769606902806958167048591938845025015179542687623201124666205126284766684526602482974072107496385950974545043261329552934262890456054327356228832079667667563851644669620122005574187684259483704883944,
//                                  -0.8765720202742478859056935548050967545616485337299619927478757518746727101403896723986855219259667852143358799948242384662297583851335787035211895586975548130288710653673627670240675622070824293344088388158312026024660289836064405088534253381328208139908628236298146864439498352402118899043,
//                                  0.8765720202742478859056935548050967545616485337299619927478757518746727101403896723986855219259667852143358799948242384662297583851335787035211895586975548130288710653673627670240675622070824293344088388158312026024660289836064405088534253381328208139908628236298146864439498352402118899043,
//                                  -0.9058791367155696728220748356710117883122621998274108453524854254710168231209903168021038398680981022214429169319017710975360013383348010715570893926035906020288754398184826444594856795580592716008531171383282133694774328791387131323934510270867503119159734775656959815632383572657867140949,
//                                  0.9058791367155696728220748356710117883122621998274108453524854254710168231209903168021038398680981022214429169319017710975360013383348010715570893926035906020288754398184826444594856795580592716008531171383282133694774328791387131323934510270867503119159734775656959815632383572657867140949,
//                                  -0.9313866907065543331141743801016012677199970856189504298706048642530730422171117004814233978308572612576107803914678314724860513072594985139003576769053733087385408190420712132114120725838908495665356346932986188420356555725712007913480683483201166114638294544452991420503249057385566622795,
//                                  0.9313866907065543331141743801016012677199970856189504298706048642530730422171117004814233978308572612576107803914678314724860513072594985139003576769053733087385408190420712132114120725838908495665356346932986188420356555725712007913480683483201166114638294544452991420503249057385566622795,
//                                  -0.9529877031604308607229606660257183432085413318239187368639476034939458705853335873459030640014006567593065907266428726812347294584753964392930795158115000641109325489714712870880297641634621723737500491906722071151348235107161758193225807469311919132905091399402956814596650320119298445784,
//                                  0.9529877031604308607229606660257183432085413318239187368639476034939458705853335873459030640014006567593065907266428726812347294584753964392930795158115000641109325489714712870880297641634621723737500491906722071151348235107161758193225807469311919132905091399402956814596650320119298445784,
//                                  -0.9705915925462472504614119838006600573024339116308837060283723521653233091284917549829147537048491975519718142430786348351156971268381219524460301022841594218867377023274789263039153971329753128283957675276638298590096929793150902506405404017374017263556524863367379420927441067400998664328,
//                                  0.9705915925462472504614119838006600573024339116308837060283723521653233091284917549829147537048491975519718142430786348351156971268381219524460301022841594218867377023274789263039153971329753128283957675276638298590096929793150902506405404017374017263556524863367379420927441067400998664328,
//                                  -0.9841245837228268577445836000265988305892392234173847299576501679855297780009805053951314899480078238327304298947042842928481799606952772566942573525021819530709401907672028961517174691513475087037175707824219016553116764594541493332276957166382649655212695959925653711732933130430827227821,
//                                  0.9841245837228268577445836000265988305892392234173847299576501679855297780009805053951314899480078238327304298947042842928481799606952772566942573525021819530709401907672028961517174691513475087037175707824219016553116764594541493332276957166382649655212695959925653711732933130430827227821,
//                                  -0.9935301722663507575479287508490741183566147495946719296171518380987546182067771786290419810076653658707794725617515799662389829710022177318209380664631193614136055345075703607668275077740411649842085541887030219645923098582169161303385895586016157196262331334058188227333163347469240571803,
//                                  0.9935301722663507575479287508490741183566147495946719296171518380987546182067771786290419810076653658707794725617515799662389829710022177318209380664631193614136055345075703607668275077740411649842085541887030219645923098582169161303385895586016157196262331334058188227333163347469240571803,
//                                  -0.9987710072524261186005414915631136400889376502767210386129404813754588436074917000156558049981457228323111399757426667107783686146764979424301931921202864901934760728750598495567831609976798771170638384784993532847474526751192964462907047527007519731784755343424413652889476747582001549614,
//                                  0.9987710072524261186005414915631136400889376502767210386129404813754588436074917000156558049981457228323111399757426667107783686146764979424301931921202864901934760728750598495567831609976798771170638384784993532847474526751192964462907047527007519731784755343424413652889476747582001549614
//};
//static long double w64[64] = {
//        0.0647376968126839225030249387365915535520819189466365100145630955230830789112652102024388586148790257788504178817149406047213653777355165787109361497393610668464404058173590514459457218162820036853260853476893083916876577017950192396753949750327804531473587112366883193491439113058399613456,
//        0.0647376968126839225030249387365915535520819189466365100145630955230830789112652102024388586148790257788504178817149406047213653777355165787109361497393610668464404058173590514459457218162820036853260853476893083916876577017950192396753949750327804531473587112366883193491439113058399613456,
//        0.0644661644359500822065041936577050657256919244555303087605584565373923533729548831698602843931871385340030175202203667683923636126306800176183882596684399495491942372660596596356926236523817913678955210087298528334383346959188152334943162945018899436306253539186876929627564832875066671546,
//        0.0644661644359500822065041936577050657256919244555303087605584565373923533729548831698602843931871385340030175202203667683923636126306800176183882596684399495491942372660596596356926236523817913678955210087298528334383346959188152334943162945018899436306253539186876929627564832875066671546,
//        0.0639242385846481866239062018255154089189740849826429998908742074995537825861121896138913510047200154797654299464853013914131198803664765984362905448826628656098363699210906102535255075640718685418176298042239357008734991509977575972169401757797865944093378190769429188446886679443503356812,
//        0.0639242385846481866239062018255154089189740849826429998908742074995537825861121896138913510047200154797654299464853013914131198803664765984362905448826628656098363699210906102535255075640718685418176298042239357008734991509977575972169401757797865944093378190769429188446886679443503356812,
//        0.063114192286254025657126022750233318127413643371100791211147247908038119210866702715591019250622765359661030504080756048509339497381338079232705821085723043595456233294264080283819162331479594340527362119300046999015126652579244400709395388878981390931908078284678001225721796422023136062,
//        0.063114192286254025657126022750233318127413643371100791211147247908038119210866702715591019250622765359661030504080756048509339497381338079232705821085723043595456233294264080283819162331479594340527362119300046999015126652579244400709395388878981390931908078284678001225721796422023136062,
//        0.0620394231598926639041977841375985183063833996650914615690378145027390359016166007430301654642341792123950625581326363632974090601727932588665503966644951620409846055448253160088846837109809554668739184790769777564218698158247876958118862217650947629303715877152671148497105041838693575829,
//        0.0620394231598926639041977841375985183063833996650914615690378145027390359016166007430301654642341792123950625581326363632974090601727932588665503966644951620409846055448253160088846837109809554668739184790769777564218698158247876958118862217650947629303715877152671148497105041838693575829,
//        0.060704439165893880052969232027820477885260864256477755111511444660637894279751753620085819634771129502321701272863759816665487721018178215213564660137215627940595964791462287316855429075024808741011644609872218806459416249834579498889811013183614485331157602894831974022969735147348883757,
//        0.060704439165893880052969232027820477885260864256477755111511444660637894279751753620085819634771129502321701272863759816665487721018178215213564660137215627940595964791462287316855429075024808741011644609872218806459416249834579498889811013183614485331157602894831974022969735147348883757,
//        0.0591148396983956357464748174335199106596556025570549985562911334858351427004807103097816283504301067145337581695456289376039830513792879318191825604750751808579778340286564325820343687137802381989835131943251463047540892402824878256504821255914479922071822226677097993296619726126963050339,
//        0.0591148396983956357464748174335199106596556025570549985562911334858351427004807103097816283504301067145337581695456289376039830513792879318191825604750751808579778340286564325820343687137802381989835131943251463047540892402824878256504821255914479922071822226677097993296619726126963050339,
//        0.0572772921004032157051502346847005762415271230041120775388499374768174542185642264331596590441971930673621537502613979228275806036649770523729037269590396605505788888297452487135047545234709500282948119277498415520755790433226932951687496519443335996237447309318373040221125631050111510598,
//        0.0572772921004032157051502346847005762415271230041120775388499374768174542185642264331596590441971930673621537502613979228275806036649770523729037269590396605505788888297452487135047545234709500282948119277498415520755790433226932951687496519443335996237447309318373040221125631050111510598,
//        0.0551995036999841628682034951916354390044509256075610005480562579305852367514577542949214003983936245935099233555326166840067728538535180246281250095428642203897649239499695557145555426826339726223278435361963395286663248980175847584856397277819554489412173746852687479370448932694933197623,
//        0.0551995036999841628682034951916354390044509256075610005480562579305852367514577542949214003983936245935099233555326166840067728538535180246281250095428642203897649239499695557145555426826339726223278435361963395286663248980175847584856397277819554489412173746852687479370448932694933197623,
//        0.0528901894851936670955050562646989146617264856331091863864912338482927624906331606970843403634381497908317850195729589364536877532718433530073031198384043794058712301651801700250106264343517104436330268731364270443107293677300896119296195993166329507710981247494486005793880120807927289435,
//        0.0528901894851936670955050562646989146617264856331091863864912338482927624906331606970843403634381497908317850195729589364536877532718433530073031198384043794058712301651801700250106264343517104436330268731364270443107293677300896119296195993166329507710981247494486005793880120807927289435,
//        0.0503590355538544749578076190878656060329940930259063306937920572469344146602481475739536937748716602476117493749244875858054285030225668399920442432703261223051996660668346813340688638213160761734150627440682870958462139218071425255284480255792269432147953655343759406749212586469145768123,
//        0.0503590355538544749578076190878656060329940930259063306937920572469344146602481475739536937748716602476117493749244875858054285030225668399920442432703261223051996660668346813340688638213160761734150627440682870958462139218071425255284480255792269432147953655343759406749212586469145768123,
//        0.0476166584924904748259066234789298301579980667434496853967698962788098850790553558921186822101807747577471093843789681954550367400998642293049039011428801469248019436301751923621082166337425051357096710523378922796487352726070502102353375510072185845091506254256366999031877822684979636883,
//        0.0476166584924904748259066234789298301579980667434496853967698962788098850790553558921186822101807747577471093843789681954550367400998642293049039011428801469248019436301751923621082166337425051357096710523378922796487352726070502102353375510072185845091506254256366999031877822684979636883,
//        0.04467456085669428041944858712585039498846278686250200843292144633919149051230219570285507033445191597262243455627672121790437329143514285719835417794752689114355605923589578220634338431225002502435368065875022942307571295172714637976516510154698183413670663877406518826782227549059860187,
//        0.04467456085669428041944858712585039498846278686250200843292144633919149051230219570285507033445191597262243455627672121790437329143514285719835417794752689114355605923589578220634338431225002502435368065875022942307571295172714637976516510154698183413670663877406518826782227549059860187,
//        0.0415450829434647492140588223610647977534728260340380630827348212227258256296586929707635839644013631284715345075710659622564449467324978249684928773840551030649825993350348553085257670883154936305063329655125785484153458390782728700528984154364603355339105273978609629412377032026386535504,
//        0.0415450829434647492140588223610647977534728260340380630827348212227258256296586929707635839644013631284715345075710659622564449467324978249684928773840551030649825993350348553085257670883154936305063329655125785484153458390782728700528984154364603355339105273978609629412377032026386535504,
//        0.0382413510658307063172172565237156178638239683549822889292581910340505392241094723284160592135801401793729375778354214012906402625157588605731423234705243025803585381465439498192468739422200783843619859665465451993517044449780382427455830953184651143173247685556045880601715355066276988534,
//        0.0382413510658307063172172565237156178638239683549822889292581910340505392241094723284160592135801401793729375778354214012906402625157588605731423234705243025803585381465439498192468739422200783843619859665465451993517044449780382427455830953184651143173247685556045880601715355066276988534,
//        0.0347772225647704388925485859638024105972813969070680987180066361796767233590362801423131281719636131419846638499551949941320248224095394378130720247934453639087592808429866374736085398086276338344886592794735316537318850395473169040328209710322551135768671808804729962027374860089837684125,
//        0.0347772225647704388925485859638024105972813969070680987180066361796767233590362801423131281719636131419846638499551949941320248224095394378130720247934453639087592808429866374736085398086276338344886592794735316537318850395473169040328209710322551135768671808804729962027374860089837684125,
//        0.0311672278327980889020657568463544194542853414835695355095437188614314126242430459323899675502770854681172632831370422789602958657379399544794489944882423669337641568778676876103415498799281931537899613937659041581231888768414972328438819770226385469193123192380972632082067588109125106551,
//        0.0311672278327980889020657568463544194542853414835695355095437188614314126242430459323899675502770854681172632831370422789602958657379399544794489944882423669337641568778676876103415498799281931537899613937659041581231888768414972328438819770226385469193123192380972632082067588109125106551,
//        0.0274265097083569482000738362625058204511841551616509759972809374993765019410236080239987462027920403237449474284444948789638628394355878066094467843602824760139004690135115733710861681278905130204344113095556099347782237196035386088178092164366260022756686042906129257040190872924606394517,
//        0.0274265097083569482000738362625058204511841551616509759972809374993765019410236080239987462027920403237449474284444948789638628394355878066094467843602824760139004690135115733710861681278905130204344113095556099347782237196035386088178092164366260022756686042906129257040190872924606394517,
//        0.0235707608393243791405193013784492302217297385221885987342390648645650637963913094518367755410967761634190806690824078462688206169213053713839743055605466423717304973224210361070599559010345444087408317436337478066837024618745352434711580028189318635705775026733754863990182519965475724838,
//        0.0235707608393243791405193013784492302217297385221885987342390648645650637963913094518367755410967761634190806690824078462688206169213053713839743055605466423717304973224210361070599559010345444087408317436337478066837024618745352434711580028189318635705775026733754863990182519965475724838,
//        0.0196161604573555278144607196522127096958130377341322391811208305074092462981216840449513783774442841949609835308771105841281547195578590179091197712101493381105236769524246761434056145453248993188037222880380082880780160676065594181655110753447781561231392530437840563066406163509859145627,
//        0.0196161604573555278144607196522127096958130377341322391811208305074092462981216840449513783774442841949609835308771105841281547195578590179091197712101493381105236769524246761434056145453248993188037222880380082880780160676065594181655110753447781561231392530437840563066406163509859145627,
//        0.0155793157229438487281769558344603139763762689915524695130934310526924333561999548391816052133014721114401358107806537024400131770649099216044201000988551783955073406285409222168389437506459771369978703174261967499687905211552648334359139017500567829091264152081809203694794919148138113686,
//        0.0155793157229438487281769558344603139763762689915524695130934310526924333561999548391816052133014721114401358107806537024400131770649099216044201000988551783955073406285409222168389437506459771369978703174261967499687905211552648334359139017500567829091264152081809203694794919148138113686,
//        0.0114772345792345394895926676090916280864205063087476406537668167410350365850873671845112866361972727003593616013319766908431686721431557599899878110361766928366128660002635276311177447975047450494623463316753479008881407947518044839424512047421057962221674204381188357080440093473240191307,
//        0.0114772345792345394895926676090916280864205063087476406537668167410350365850873671845112866361972727003593616013319766908431686721431557599899878110361766928366128660002635276311177447975047450494623463316753479008881407947518044839424512047421057962221674204381188357080440093473240191307,
//        0.0073275539012762621023839796217865500587079025592013532748818295488069800725028316706480375165203492985348352058130145019210595229781155983356959210927756601384839999895988071487053794233206191516948990247724302244333532639963678373653429402048630396323584935042879329231777271594470137779,
//        0.0073275539012762621023839796217865500587079025592013532748818295488069800725028316706480375165203492985348352058130145019210595229781155983356959210927756601384839999895988071487053794233206191516948990247724302244333532639963678373653429402048630396323584935042879329231777271594470137779,
//        0.0031533460523058386326773115438914875782839388316936222952094932503195864383168624422174587740479242783786832411810766857395666084711474099319465151509325584851182123492882592877145774634208031405492080241435958192743600081224060525654433479828742651348932788741657302081374766455222910404,
//        0.0031533460523058386326773115438914875782839388316936222952094932503195864383168624422174587740479242783786832411810766857395666084711474099319465151509325584851182123492882592877145774634208031405492080241435958192743600081224060525654433479828742651348932788741657302081374766455222910404
//};
int main() {
    // 1. generate domain mesh.
    int M = 16;
    int sample = 2497;
//    geometry_triangle *domain = new geometry_triangle();
    Array<scalar_t> boundary_points((size_t) (2 * SQR(M + 1)));

    scalar_t dx = 1.0 / M;

    int bid = 0;
    for (int r = 0; r < M + 1; ++r) {
        for (int c = 0; c < M + 1; ++c) {
            boundary_points[bid++] = r * dx;
            boundary_points[bid++] = c * dx;
        }
    }


    Array<int> edge_connection(6 * SQR(M) + 4 * M);


    int eid = 0;
    for (int r = 0; r < M; ++r) {
        for (int c = 0; c < M + 1; ++c) {
            edge_connection[eid++] = r * (M + 1) + c;
            edge_connection[eid++] = (r + 1) * (M + 1) + c;
        }
    }

    for (int c = 0; c < M; ++c) {
        for (int r = 0; r < M + 1; ++r) {
            edge_connection[eid++] = r * (M + 1) + c;
            edge_connection[eid++] = r * (M + 1) + c + 1;
        }
    }

    for (int r = 0; r < M; ++r) {
        for (int c = 0; c < M; ++c) {
            edge_connection[eid++] = r * (M + 1) + (c + 1);
            edge_connection[eid++] = (r + 1) * (M + 1) + c;
        }
    }


    //generate_domain(boundary_points, edge_connection, "prq34.0a" + std::to_string(area[S]) + "nzjQ", domain);


    geometry_triangle *setting = new geometry_triangle();
    setting->set_points(boundary_points);
    setting->set_facets(edge_connection);
    geometry_triangle *domain = new geometry_triangle();
    setting->build("pznjQ", *domain);
    free(setting);

    reorg(domain);


    domain->getAllArea();
    domain_information(domain);

    // 1-1. get near field.
    vector<vector<int>> nearField;
    domain->getNearField(nearField);

    // 2. get high order quadrature rule on standard reference triangle T1.
    QRule_tri quadratue_rule;
    get_vr_data(14, quadratue_rule);
    affine(quadratue_rule);
    modes_information(quadratue_rule);
    index_t coarseQuadratureSize = quadratue_rule.weights.size();


    // 3. generate source, target nodes.
    vector<point> source, target;
    vector<scalar_t> weights;

    for (index_t i = 0; i < domain->numberoftriangles; ++i) {

        auto _u = domain->getTriangle(3 * i);
        auto _v = domain->getTriangle(3 * i + 1);
        auto _w = domain->getTriangle(3 * i + 2);

        auto _area = domain->arealist[i];

        for (index_t j = 0; j < coarseQuadratureSize; ++j) {
            auto lambda = (scalar_t) quadratue_rule.points_x[j];
            auto mu = (scalar_t) quadratue_rule.points_y[j];
            point p = {
                    domain->getX(_u) * lambda +
                    domain->getX(_v) * mu +
                    domain->getX(_w) * (1.0 - lambda - mu),
                    domain->getY(_u) * lambda +
                    domain->getY(_v) * mu +
                    domain->getY(_w) * (1.0 - lambda - mu)
            };

            source.push_back(p);
            target.push_back(p);

            weights.push_back(2.0 * _area * quadratue_rule.weights[j]);
        }
    }

    // 4. FMM
    // calculate particle interactions, near field is included.
    index_t np = 9;
    /*
     * G.eval (source ,target).
     */
    kernel G;
    G.eval = [&](point &a, point &b) {
        scalar_t dist = sqrt(SQR(b.x - a.x) + SQR(b.y - a.y));
        if (dist == 0.) return 0.;
        return 1.0 / dist;
    };

    Vector p((int) source.size());
    Vector rhs((int) source.size());
    setValue(p, 0.);
    setValue(rhs, 0.);

    for (int i = 0; i < rhs.row(); ++i) {
        rhs(i) = pow(source[i].x, 2) * pow(source[i].y, 7);
    }


    for (int i = 0; i < p.row(); ++i) {

        p(i) = (rhs(i)) * weights[i];
    }

    RUN("quadtree", G.initialize(np, source, target, p, (index_t) source.size(), (index_t) target.size(), np * np, 10));
    Vector ret;
    G.run(ret);

    std::cout << std::setprecision(15) << std::scientific << "FMM: " << ret(sample) << std::endl;

    std::cout << std::setprecision(15) << std::scientific << "SAMPLE AT " << source[sample].x << " " << source[sample].y
              << std::endl;

//
//    for (int tt = 0; tt < domain->numberoftriangles;++tt){
//
//        std::cout << domain->getX(domain->_meta.trianglelist[3*tt]) << " " <<  domain->getY(domain->_meta.trianglelist[3*tt]) << std::endl;
//        std::cout << domain->getX(domain->_meta.trianglelist[3*tt+1]) << " " <<  domain->getY(domain->_meta.trianglelist[3*tt+1]) << std::endl;
//        std::cout << domain->getX(domain->_meta.trianglelist[3*tt+2]) << " " <<  domain->getY(domain->_meta.trianglelist[3*tt+2]) << std::endl;
//
//        std::cout << "\n";
//    }



//    int uu = domain->_meta.trianglelist[0];
//    int vv = domain->_meta.trianglelist[1];
//    int ww = domain->_meta.trianglelist[2];

//    std::cout << domain->getX(uu) << " " << domain->getY(uu) << ", " << domain->getX(vv) << " " << domain->getY(vv) << ", "<<domain->getX(ww) << " " << domain->getY(ww) << std::endl;
    // 5. Remove near interaction.

    std::chrono::steady_clock::time_point begin = std::chrono::steady_clock::now();

    Vector coarseNearInteraction((int) target.size());
    setValue(coarseNearInteraction, 0.);

    for (int targetTriangleId = 0; targetTriangleId < domain->numberoftriangles; ++targetTriangleId) {
        for (int targetQuadratureId = 0; targetQuadratureId < quadratue_rule.weights.size(); ++targetQuadratureId) {

            int targetId = (int) (coarseQuadratureSize * targetTriangleId + targetQuadratureId);

            for (int nearSourceTriangleId = 0;
                 nearSourceTriangleId < nearField[targetTriangleId].size();
                 ++nearSourceTriangleId) {
                for (int nearSourceQuadratureId = 0;
                     nearSourceQuadratureId < quadratue_rule.weights.size(); ++nearSourceQuadratureId) {

                    int nearSourceId = (int) (coarseQuadratureSize * nearField[targetTriangleId][nearSourceTriangleId] +
                            nearSourceQuadratureId);
                    coarseNearInteraction(targetId) += G.eval(source[nearSourceId], target[targetId]) * p(nearSourceId);

                }
            }
        }
    }

    daxpy(-1.0, coarseNearInteraction, ret);

    std::chrono::steady_clock::time_point end = std::chrono::steady_clock::now();
    std::cout << std::setw(15) << "REMOVE" << " " << std::setprecision(5) << std::setw(8)
              << std::chrono::duration_cast<std::chrono::microseconds>(end - begin).count() / 1000000.0 << " seconds"
              << std::endl;

    std::cout << std::setprecision(15) << std::scientific << "REMOVED : " << ret(sample) << " "
              << coarseNearInteraction(sample) << std::endl;


    // 5. Near field re-calculation.
    // use interpolation for near field.
    // There will be T * 12 * M^2 * (4^l) flops.
    // storage: (4^l * M) x M, precomputed.


    // 5-1 build interpolation matrix, by producting the same matrix.
    // The matrix is of size (4^level * M) x M
    // Time cost is linear, but constant will be huge.
    // The interpolation matrix is uniform.
    Matrix interpolate(coarseQuadratureSize, coarseQuadratureSize);

    int nC = int((-3.0 + sqrt(9 + 8 * coarseQuadratureSize)) / 2.0);
    assert((nC + 1) * (nC + 2) == 2 * coarseQuadratureSize);

    makeKoornwinderMatrix(interpolate, nC, quadratue_rule.points_x, quadratue_rule.points_y, quadratue_rule.weights);

    Vector sqrtW((int) quadratue_rule.weights.size());
    for (int wi = 0; wi < quadratue_rule.weights.size(); ++wi) {
        sqrtW(wi) = (scalar_t) sqrt(quadratue_rule.weights[wi]);
    }


    int nRefineLevel = 2;
    int refineQuadratureSize = coarseQuadratureSize;

    vector<long double> refine_quad_x, refine_quad_y, refine_weight;

    for (int level = 0; level < nRefineLevel; ++level) {
        for (int id = 0; id < refineQuadratureSize; ++id) {
            refine_quad_x.push_back(quadratue_rule.points_x[id] / 2.0);
            refine_quad_y.push_back(quadratue_rule.points_y[id] / 2.0);
            refine_weight.push_back(quadratue_rule.weights[id] / 4.0);

            refine_quad_x.push_back(quadratue_rule.points_x[id] / 2.0);
            refine_quad_y.push_back(quadratue_rule.points_y[id] / 2.0 + 0.50);
            refine_weight.push_back(quadratue_rule.weights[id] / 4.0);

            refine_quad_x.push_back(quadratue_rule.points_x[id] / 2.0 + 0.50);
            refine_quad_y.push_back(quadratue_rule.points_y[id] / 2.0);
            refine_weight.push_back(quadratue_rule.weights[id] / 4.0);

            refine_quad_x.push_back(0.50 - quadratue_rule.points_x[id] / 2.0);
            refine_quad_y.push_back(0.50 - quadratue_rule.points_y[id] / 2.0);
            refine_weight.push_back(quadratue_rule.weights[id] / 4.0);
        }

        quadratue_rule.points_x = refine_quad_x;
        quadratue_rule.points_y = refine_quad_y;
        quadratue_rule.weights = refine_weight;
        refineQuadratureSize *= 4;


        refine_quad_x.clear();
        refine_quad_y.clear();
        refine_weight.clear();
    }

    Vector sqrtWR((int) quadratue_rule.weights.size());
    for (int wi = 0; wi < quadratue_rule.weights.size(); ++wi) {
        sqrtWR(wi) = (scalar_t) sqrt(quadratue_rule.weights[wi]);
    }


    Matrix refinements(coarseQuadratureSize, refineQuadratureSize);
    makeKoornwinderMatrix(refinements, nC, quadratue_rule.points_x, quadratue_rule.points_y, quadratue_rule.weights);

    Matrix mapping(refineQuadratureSize, coarseQuadratureSize);
    t_dgemm(1.0, refinements, interpolate, 0., mapping);


    Vector Rout(refineQuadratureSize);
    setValue(Rout, 0.);
    dgemv(1.0, mapping, sqrtW, 0., Rout);

    daxpy(-1.0, sqrtWR, Rout);

    std::cout << nrm2(Rout) << std::endl;

    // 5-2. Evaluate refined quadrature.
    // todo: improve the application of interpolation matrix. should be linear to depth, not exponential.

    begin = std::chrono::steady_clock::now();

    Vector refineNearInteraction((int) target.size());
    setValue(refineNearInteraction, 0.);

//#pragma omp parallel for schedule(static, 80) collapse(2) num_threads(4)
    for (int targetTriangleId = 0; targetTriangleId < domain->numberoftriangles; ++targetTriangleId) {
        for (int targetQuadratureId = 0; targetQuadratureId < coarseQuadratureSize; ++targetQuadratureId) {

            int targetId = (int) (coarseQuadratureSize * targetTriangleId + targetQuadratureId);

            for (int nearSourceTriangleId = 0;
                 nearSourceTriangleId < nearField[targetTriangleId].size();
                 ++nearSourceTriangleId) {

                if (nearField[targetTriangleId][nearSourceTriangleId] == targetTriangleId) continue;

                auto near_u = domain->getTriangle(3 * nearField[targetTriangleId][nearSourceTriangleId]);
                auto near_v = domain->getTriangle(3 * nearField[targetTriangleId][nearSourceTriangleId] + 1);
                auto near_w = domain->getTriangle(3 * nearField[targetTriangleId][nearSourceTriangleId] + 2);

                Vector newValues(refineQuadratureSize);
                Vector oldValues(coarseQuadratureSize);

                for (int sourceQuadratureId = 0; sourceQuadratureId < coarseQuadratureSize; ++sourceQuadratureId) {
                    oldValues(sourceQuadratureId) =
                            p(coarseQuadratureSize * nearField[targetTriangleId][nearSourceTriangleId] +
                                      sourceQuadratureId) / sqrtW(sourceQuadratureId);
                }

                setValue(newValues, 0.);

                dgemv(1.0, mapping, oldValues, 0., newValues);

                for (int nearSourceQuadratureId = 0;
                     nearSourceQuadratureId < refineQuadratureSize; ++nearSourceQuadratureId) {

                    scalar_t lambda = (scalar_t) quadratue_rule.points_x[nearSourceQuadratureId];
                    scalar_t mu = (scalar_t) quadratue_rule.points_y[nearSourceQuadratureId];
                    scalar_t w = (scalar_t) quadratue_rule.weights[nearSourceQuadratureId];


                    point cur_nearSourcePoint = {
                            domain->getX(near_u) * lambda +
                            domain->getX(near_v) * mu +
                            domain->getX(near_w) * (1.0 - lambda - mu),
                            domain->getY(near_u) * lambda +
                            domain->getY(near_v) * mu +
                            domain->getY(near_w) * (1.0 - lambda - mu)
                    };

                    refineNearInteraction(targetId) +=
                            G.eval(cur_nearSourcePoint, target[targetId]) * sqrt(w) * newValues(nearSourceQuadratureId);

                }
            }
        }
    }

    end = std::chrono::steady_clock::now();
    std::cout << std::setw(15) << "NEAR" << " " << std::setprecision(5) << std::setw(8)
              << std::chrono::duration_cast<std::chrono::microseconds>(end - begin).count() / 1000000.0 << " seconds"
              << std::endl;

    std::cout << std::setprecision(15) << std::scientific << "REFINED " << ret(sample) << " "
              << refineNearInteraction(sample) << std::endl;


    daxpy(1.0, refineNearInteraction, ret);


    // 6. All singular integral.
    // on each triangle, integrate with high order rule with tensored L^2 points
    // There will be ~ T * M^2 * 3L^2 flops.
    // plus storage: (M * 3L^2) * M has to be precomputed.


    // 6-1. get local quadrature rule, pre-compute
    // we know that P f(x,y)sqrt(w) = coefficients of Koorn polynomials.
    // We need to precompute int phi_{nk}(y)/|x-y| dy over reference triangle.

    vector<scalar_t> X1;
    vector<scalar_t> Y1;
    vector<scalar_t> W1;
    vector<scalar_t> X2;
    vector<scalar_t> Y2;
    vector<scalar_t> W2;
    vector<scalar_t> X3;
    vector<scalar_t> Y3;
    vector<scalar_t> W3;

    Matrix basis(coarseQuadratureSize, coarseQuadratureSize);
    setValue(basis, 0.);


    QRule_tri quadratue_rule_old;
    get_vr_data(14, quadratue_rule_old);
    affine(quadratue_rule_old);


//    std::cout << quadratue_rule_old.points_x[0] << " " << quadratue_rule_old.points_y[0] <<" " << quadratue_rule_old.weights[0] << std::endl;

    int row = 0;

    begin = std::chrono::steady_clock::now();


    for (int n = 0; n <= nC; ++n) {
        for (int k = 0; k <= n; ++k) {
            for (int I = 0; I < coarseQuadratureSize; ++I) {
                duffy_transform({quadratue_rule_old.points_x[I], quadratue_rule_old.points_y[I], 0, 1, 0, 0}, X1, Y1,
                                W1);
                duffy_transform({quadratue_rule_old.points_x[I], quadratue_rule_old.points_y[I], 1, 0, 0, 1}, X2, Y2,
                                W2);
                duffy_transform({quadratue_rule_old.points_x[I], quadratue_rule_old.points_y[I], 0, 0, 1, 0}, X3, Y3,
                                W3);


                for (int q = 0; q < W1.size(); ++q) {
                    basis(row, I) += koornwinder(n, k,
                                                 X1[q], Y1[q]) * W1[q] /
                                     sqrt(SQR(X1[q] - quadratue_rule_old.points_x[I]) +
                                          SQR(Y1[q] - quadratue_rule_old.points_y[I]));
                }

                for (int q = 0; q < W2.size(); ++q) {
                    basis(row, I) += koornwinder(n, k,
                                                 X2[q], Y2[q]) * W2[q] /
                                     sqrt(SQR(X2[q] - quadratue_rule_old.points_x[I]) +
                                          SQR(Y2[q] - quadratue_rule_old.points_y[I]));
                }

                for (int q = 0; q < W3.size(); ++q) {
                    basis(row, I) += koornwinder(n, k,
                                                 X3[q], Y3[q]) * W3[q] /
                                     sqrt(SQR(X3[q] - quadratue_rule_old.points_x[I]) +
                                          SQR(Y3[q] - quadratue_rule_old.points_y[I]));
                }
            }
            row++;
        }
    }


    end = std::chrono::steady_clock::now();
    std::cout << std::setw(15) << "PRECOMPUTE" << " " << std::setprecision(5) << std::setw(8)
              << std::chrono::duration_cast<std::chrono::microseconds>(end - begin).count() / 1000000.0 << " seconds"
              << std::endl;
    // if we are lucky, basis will have 4~6 digits without problem.
//    std::cout <<std::setprecision(15) << std::scientific<< basis<< std::endl;


    int prow = 0;
    vector<scalar_t> LL(quadratue_rule_old.weights.size());
    for (int n = 0; n <= nC; ++n) {
        for (int k = 0; k <= n; ++k) {
            for (int I = 0; I < quadratue_rule_old.weights.size(); ++I) {
                LL[prow] += SQR(koornwinder(n, k, quadratue_rule_old.points_x[I], quadratue_rule_old.points_y[I]) *
                                sqrt(quadratue_rule_old.weights[I]));
            }
            LL[prow] = sqrt(LL[prow]);
            prow += 1;
        }
    }


//    for (auto l : LL) {
//        std::cout << std::setprecision(15)<<l << std::endl;
//    }


    for (int r = 0; r < basis.row(); ++r) {
        for (int c = 0; c < basis.col(); ++c) {
            basis(r, c) /= LL[r];
        }
    }

    Matrix local(coarseQuadratureSize, coarseQuadratureSize);
    t_dgemm(1.0, basis, interpolate, 0., local);

//    Vector llout(coarseQuadratureSize);
//    Vector input(coarseQuadratureSize);
//
//    setValue(llout, 0.);
//
//    for (int i = 0; i < coarseQuadratureSize;++i) {
//        input(i) = rhs(i + coarseQuadratureSize *0)* sqrtW(i);
//    }
//
//
//
//    dgemv(1.0,interpolate, input, 0., llout);
//
//    std::cout << llout << std::endl;
//
//    Vector llout2(coarseQuadratureSize);
//    setValue(llout2, 0.);
//    dgemv(1.0,local, input, 0., llout2);
//
//    std::cout << llout2<< std::endl;



    for (int tid = 0; tid < domain->numberoftriangles; ++tid) {
        for (int qid = 0; qid < coarseQuadratureSize; ++qid) {
            for (int rid = 0; rid < coarseQuadratureSize; ++rid) {
                ret(tid * coarseQuadratureSize + qid) +=
                        rhs(tid * coarseQuadratureSize + rid) * sqrtW(rid) * local(qid, rid) / M;
            }
        }
    }


    std::cout << std::setprecision(15) << ret(sample) << std::endl;

    delete (domain);
    return 0;
}

extern void domain_information(geometry_triangle *in) {
#ifdef DISP
    std::cout << std::setw(15) << "vertices" << std::setw(8) << in->_meta.numberofpoints << std::endl;
    std::cout << std::setw(15) << "triangles" << std::setw(8) << in->_meta.numberoftriangles << std::endl;
    std::cout << std::setw(15) << "edges" << std::setw(8) << in->_meta.numberofedges << std::endl;
    std::cout << std::setw(15) << "segments" << std::setw(8) << in->_meta.numberofsegments << std::endl;
    std::cout << std::endl;
#endif
}

extern void modes_information(QRule_tri &rule) {
#ifdef DISP
    std::cout << std::setw(15) << "degree" << std::setw(8) << rule.degree << std::endl;
    std::cout << std::setw(15) << "#points" << std::setw(8) << rule.points_x.size() << std::endl;
    std::cout << std::endl;
#endif
}

extern void
makeKoornwinderMatrix(Matrix &K, int N, vector<long double> &x, vector<long double> &y, vector<long double> &w) {
    // assume matrix size is correct.
    int row = 0;
    for (int n = 0; n <= N; ++n) {
        for (int k = 0; k <= n; ++k) {
            for (int I = 0; I < x.size(); ++I) {
                K(row, I) = (scalar_t) (koornwinder(n, k, x[I], y[I]) * sqrt(w[I]));
            }
            row += 1;
        }
    }

    for (int r = 0; r < K.row(); ++r) {
        long double nrm = 0.;
        for (int c = 0; c < K.col(); ++c) {
            nrm += SQR(K(r, c));
        }
        nrm = sqrt(nrm);
        for (int c = 0; c < K.col(); ++c) {
            K(r, c) /= nrm;
        }
    }
}

extern void reorg(geometry_triangle *in) {
    /*
     * traverse all triangles and reorder.
     */
    scalar_t x1, y1, x2, y2, x3, y3;
    scalar_t angle1, angle2, angle3; // cosine value
    scalar_t s1, s2, s3; // side

    int cnt1 = 0, cnt2 = 0, cnt3 = 0;

    for (int tid = 0; tid < in->numberoftriangles; ++tid) {
        int u = in->getTriangle(3 * tid);
        int v = in->getTriangle(3 * tid + 1);
        int w = in->getTriangle(3 * tid + 2);

        x1 = in->getX(u);
        y1 = in->getY(u);
        x2 = in->getX(v);
        y2 = in->getY(v);
        x3 = in->getX(w);
        y3 = in->getY(w);

        s1 = sqrt(SQR(x2 - x3) + SQR(y2 - y3));
        s2 = sqrt(SQR(x1 - x3) + SQR(y1 - y3));
        s3 = sqrt(SQR(x1 - x2) + SQR(y1 - y2));


        angle1 = (SQR(s2) + SQR(s3) - SQR(s1)) / (2 * s2 * s3);
        angle2 = (SQR(s1) + SQR(s3) - SQR(s2)) / (2 * s1 * s3);
        angle3 = (SQR(s1) + SQR(s2) - SQR(s3)) / (2 * s1 * s2);

        if (fabs(angle1) < EPS) {
            in->_meta.trianglelist[3 * tid] = v;
            in->_meta.trianglelist[3 * tid + 1] = w;
            in->_meta.trianglelist[3 * tid + 2] = u;
            cnt1++;

        } else if (fabs(angle3) < EPS) {
            //nothing
            cnt2++;
        } else if (fabs(angle2) < EPS) {
            in->_meta.trianglelist[3 * tid] = w;
            in->_meta.trianglelist[3 * tid + 1] = u;
            in->_meta.trianglelist[3 * tid + 2] = v;
            cnt3++;
        } else {
            std::cout << tid << ": (" << u << " " << v << " " << w << ") " << "not with correct shape" << std::endl;
        }

    }
    std::cout << cnt1 << " " << cnt2 << " " << cnt3 << std::endl;
}

extern void duffy_transform(vector<scalar_t> points, vector<scalar_t> &X, vector<scalar_t> &Y, vector<scalar_t> &W) {
    scalar_t a = points[0];
    scalar_t b = points[1];

    scalar_t a11 = points[2] - points[0];
    scalar_t a12 = points[4] - points[2];
    scalar_t a21 = points[3] - points[1];
    scalar_t a22 = points[5] - points[3];

    Matrix A(2, 2);
    A(0, 0) = a11;
    A(0, 1) = a12;
    A(1, 0) = a21;
    A(1, 1) = a22;

    scalar_t detA = a11 * a22 - a12 * a21;

    int nsp = 128;

    vector<scalar_t> sx(nsp * nsp);
    vector<scalar_t> sy(nsp * nsp);
    vector<scalar_t> sw(nsp * nsp);


    int id = 0;
    for (int ri = 0; ri < nsp; ++ri) {
        for (int ci = 0; ci < nsp; ++ci) {
            sx[id] = (x64[ri] + 1.0) / 2.0;
            sy[id] = (x64[ci] + 1.0) / 2.0;
            sw[id++] = w64[ri] * w64[ci] / 4.0;
        }
    }

    vector<scalar_t> Z1x(nsp * nsp);
    vector<scalar_t> Z1y(nsp * nsp);
    vector<scalar_t> Z1w(nsp * nsp);

    X.resize(nsp * nsp);
    Y.resize(nsp * nsp);
    W.resize(nsp * nsp);


    for (int i = 0; i < nsp * nsp; ++i) {
        scalar_t u = sx[i];
        scalar_t v = sy[i];
        scalar_t w = sw[i];

        Z1x[i] = u;
        Z1y[i] = u * v;
        Z1w[i] = w * u;

        u = Z1x[i];
        v = Z1y[i];
        w = Z1w[i];

        scalar_t x = a11 * u + a12 * v + a;
        scalar_t y = a21 * u + a22 * v + b;
        scalar_t wr = detA * w;

        X[i] = x;
        Y[i] = y;
        W[i] = wr;
    }
}